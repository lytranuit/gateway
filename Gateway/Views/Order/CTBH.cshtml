@model ApplicationChart.Models.CTBH
@{
    ViewBag.Title = "CHƯƠNG TRÌNH BÁN HÀNG";
    Layout = "~/Views/Shared/Layout1.cshtml";
}
@section styles {
    <link href="~/Content/Datatable.css?version=11" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />
    <link rel="stylesheet" href="~/Content/OrderStyle.css?version=43">
    <style>
        .dropdown-menu {
            font-size: 12px;
        }

        .custom-control-label {
            font-size: 17px;
        }

        .table td, .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
            font-size: 11px !important;
        }

        .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
            line-height: 26px;
        }

        .overflow-auto {
            overflow: auto !important;
        }

        .checkbox {
            font-size: 15px;
        }
    </style>
}
<div id="heightscreen">
    <div class="w3-card w3-white" style="border-radius:0.25rem">
        <ol class="breadcrumb" style="margin-top:42px;margin-bottom:0px;">
            <li class="breadcrumb-item"><a style="color:#007bff;font-weight:700" href="#">CRM</a></li>
            <li class="breadcrumb-item active w3-text-black font-weight-normal">CHƯƠNG TRÌNH BÁN HÀNG - HỖ TRỢ</li>
        </ol>
    </div>
    <div class="w3-content p-1 box" style="background-color:white;" id="Viewtable">
        <div class="card-header text-center">
            <strong>CHƯƠNG TRÌNH BÁN HÀNG</strong>
        </div>
        <table id="example23" class="display nowrap table table-hover table-bordered w-100 pt-0 mb-1 table-responsive-sm">
            <!--Table head-->
            <thead style="background-color:rgb(66, 133, 244);">
                <tr class="text-white">
                    <th>Trạng thái</th>
                    <th>Mã CTBH</th>
                    <th>Tên CTBH</th>
                    <th>Từ ngày</th>
                    <th>Đến ngày</th>
                    <th class="no-sort"></th>
                </tr>
            </thead>
            <tbody>
                @{
                    foreach (var i in Model.ctkm)
                    {
                        <tr>
                            <td class="text-center">
                                @if (DateTime.Now < i.ngayketthuc.AddDays(1))
                                {
                                    <span style="font-size:11px;" class="badge badge-success">Hiệu lực</span>
                                }
                                else
                                {
                                    <span style="font-size:11px;" class="badge badge-danger">Hết hạn</span>
                                }
                            </td>
                            <td class="text-center">@i.MACTKM</td>
                            <td>@i.TENCTKM</td>
                            <td class="text-center">@((i.ngaybatdau != null) ? ((DateTime)i.ngaybatdau).ToString("dd/MM/yyyy") : "N/A")</td>
                            <td class="text-center">@((i.ngayketthuc != null) ? ((DateTime)i.ngayketthuc).ToString("dd/MM/yyyy") : "N/A")</td>
                            <td class="p-1 align-middle text-center">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-primary rounded-0 pl-2 pr-2" data-toggle="dropdown">
                                        <span class="fa fa-caret-down"></span>
                                    </button>
                                    <ul class="dropdown-menu text-left dropdown-menu-right">
                                        <li><a class="btnchitiet" data-toggle="modal" data-backdrop="static" data-target="#ModalView">Thông tin chi tiết</a></li>
                                        @if (i.FILEDATA == true)
                                        {
                                            <li><a href="/crm/chi-tiet-chuong-trinh-ban-hang?MACTKM=@i.MACTKM" target="_blank" class="btnviewpdf">Xem file PDF</a></li>
                                        }
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    }
                }
            </tbody>
            <!--Table body-->
        </table>

    </div>
    <div class="w3-content p-1 box" style="background-color:white;" id="Viewtable1">
        <div class="card-header text-center">
            <strong>CHƯƠNG TRÌNH HỖ TRỢ</strong>
        </div>
        <table id="example233" class="display nowrap table table-hover table-bordered w-100 pt-0 mb-1 table-responsive-sm">
            <!--Table head-->
            <thead style="background-color:rgb(66, 133, 244);">
                <tr class="text-white">
                    <th>Trạng thái</th>
                    <th>Mã CTHT</th>
                    <th>Tên CTHT</th>
                    <th>Từ ngày</th>
                    <th>Đến ngày</th>
                    <th class="no-sort"></th>
                </tr>
            </thead>
            <tbody>
                @{
                    foreach (var i in Model.ctht)
                    {
                        <tr>
                            <td class="text-center">
                                @if (DateTime.Now < i.ngayketthuc.AddDays(1))
                                {
                                    <span style="font-size:11px;" class="badge badge-success">Hiệu lực</span>
                                }
                                else
                                {
                                    <span style="font-size:11px;" class="badge badge-danger">Hết hạn</span>
                                }
                            </td>
                            <td class="text-center">@i.MACTKM</td>
                            <td>@i.TENCTKM</td>
                            <td class="text-center">@((i.ngaybatdau != null) ? ((DateTime)i.ngaybatdau).ToString("dd/MM/yyyy") : "N/A")</td>
                            <td class="text-center">@((i.ngayketthuc != null) ? ((DateTime)i.ngayketthuc).ToString("dd/MM/yyyy") : "N/A")</td>
                            <td class="p-1 align-middle text-center">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-primary rounded-0 pl-2 pr-2" data-toggle="dropdown">
                                        <span class="fa fa-caret-down"></span>
                                    </button>
                                    <ul class="dropdown-menu text-left dropdown-menu-right">
                                        <li><a class="btnchitiet" data-toggle="modal" data-backdrop="static" data-target="#ModalView">Thông tin chi tiết</a></li>
                                        @if (i.FILEDATA == true)
                                        {
                                            <li><a href="/crm/chi-tiet-chuong-trinh-ban-hang?MACTHT=@i.MACTKM" target="_blank" class="btnviewpdf">Xem file PDF</a></li>
                                        }
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    }
                }
            </tbody>
            <!--Table body-->
        </table>

    </div>
</div>
<div class="modal fade" id="ModalView" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered scrollable-auto-y mt-md-auto" style="max-width:800px" role="document">
        <div class="modal-content" id="PartialModal">

        </div>
    </div>
</div>
@section scripts {
    @*<script type="text/javascript" src="~/Scripts/bootstrap-datepicker.js?version=1"></script>*@
    <script src="~/Scripts/bootstrap-select.js?version=3"></script>
    <script src="~/Content/Order/js/lib/datatables/datatables.min.js?version=6"></script>
    <script>
        Number.prototype.format = function () {
            var text = this.toString().split(/(?=(?:\d{3})+(?:\.|$))/g).join(",");
            if (text != "NaN") {
                return text;
            }
            else {
                return "N/A";
            }
        };
    </script>
    <script>
        $(document).ready(function () {
            $('#example23').DataTable({
                "columnDefs": [{
                    "targets": 'no-sort',
                    "orderable": false,
                }],
                "order": [],
            });
            $('#example233').DataTable({
                "columnDefs": [{
                    "targets": 'no-sort',
                    "orderable": false,
                }],
                "order": [],
            });
            $("#Viewtable").on("click", ".btnchitiet", function () {
                var mactkm = $(this).closest('tr').find('td:eq(1)').text();
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("PartialViewCTBH", "Order")",
                    datatype: 'json',
                    contentType: "application/json",
                    data: '{mactkm: ' + JSON.stringify(mactkm) + '}',
                    error: function () {
                        $('#loading').modal('hide');
                        toastr.options = {
                            "closeButton": true,
                            "debug": false,
                            "newestOnTop": true,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        Command: toastr["warning"]("Lấy dữ liệu thấy bại, vui lòng thử lại", "Lỗi")
                    },
                    success: function (data) {
                        $("#PartialModal").html(data);
                    },
                    timeout: 5000,
                });
            });
            $("#Viewtable1").on("click", ".btnchitiet", function () {
                var mactht = $(this).closest('tr').find('td:eq(1)').text();
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("PartialViewCTHT", "Order")",
                    datatype: 'json',
                    contentType: "application/json",
                    data: '{mactht: ' + JSON.stringify(mactht) + '}',
                    error: function () {
                        $('#loading').modal('hide');
                        toastr.options = {
                            "closeButton": true,
                            "debug": false,
                            "newestOnTop": true,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        Command: toastr["warning"]("Lấy dữ liệu thấy bại, vui lòng thử lại", "Lỗi")
                    },
                    success: function (data) {
                        $("#PartialModal").html(data);
                    },
                    timeout: 5000,
                });
            });
        });

    </script>
}

