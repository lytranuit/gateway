@model ApplicationChart.Models.ListData
@{
    ViewBag.Title = "Danh sách đơn hàng";
    Layout = "~/Views/Shared/Layout1.cshtml";
}
@section styles {
    <link href="~/Content/Datatable.css?version=11" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />
    <link rel="stylesheet" href="~/Content/OrderStyle.css?version=43">
    <style>
        .dropdown-menu {
            font-size: 12px;
        }

        .custom-control-label {
            font-size: 17px;
        }

        .modal-dialog {
            margin: auto !important;
        }

        .table td, .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
            font-size: 11px !important;
        }

        .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
            line-height: 26px;
        }

        td .form-control {
            font-size: 12px;
            height: 32px;
        }

        .font-small {
            font-size: .85rem;
        }

        .dataTables_wrapper {
            padding-top: 0px;
        }

        .modal-header .close {
            padding: 1rem;
            margin: -8px -7px -13px auto;
        }

        #dmhh {
            overflow-y: auto;
        }
    </style>
}
<div id="heightscreen">
    <div class="w3-card w3-white" style="border-radius:0.25rem">
        <ol class="breadcrumb" style="margin-top:42px;margin-bottom:0px;">
            <li class="breadcrumb-item"><a style="color:#007bff;font-weight:700" href="#">CRM</a></li>
            <li class="breadcrumb-item active w3-text-black font-weight-normal">DANH SÁCH ĐƠN HÀNG</li>
        </ol>
    </div>
    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()
        <div class="w3-container box text-left" style="margin-top:3px;margin-bottom:2px;background-color:white;">
            <div class="row pt-2 pb-2">
                <div class="form-group col-lg- col-md-6 col-sm-6 mb-1">
                    <label class="col-form-label" for="formGroupExampleInput">Từ ngày</label>
                    <input type="text" class="form-control NGAY" name="tungay" id="tungay1" placeholder="DD/MM/YYYY" data-validation="digit" data-inputmask="'alias': 'dd/mm/yyyy'" data-mask="" autocomplete="off">
                </div>
                <div class="form-group col-lg-6 col-md-6 col-sm-6 mb-1">
                    <label class="col-form-label" for="formGroupExampleInput">Đến ngày</label>
                    <input type="text" class="form-control NGAY" name="denngay" id="denngay1" placeholder="DD/MM/YYYY" data-validation="digit" data-inputmask="'alias': 'dd/mm/yyyy'" data-mask="" autocomplete="off">
                </div>
                <div class="btn-group col-12 mt-1" col-md-6 role="group" aria-label="Basic example">
                    <button id="btnsubmit" style="height:auto;width:auto;" type="submit" class="btn btn-success btn-sm transition-3d-hover"><i class="fa fa-search" style="font-size: 1.4em;" aria-hidden="true"></i> TÌM KIẾM</button>
                    <button style="height:auto;width:auto;" type="button" class="btn btn-danger btn-sm transition-3d-hover" onClick="location.href='@Url.Action("danh-sach-don-dat-hang", "Order")';return false;"><i class="fa fa-arrow-left" style="font-size: 1.4em;" aria-hidden="true"></i> TRỞ VỀ</button>
                </div>
            </div>
        </div>
        <div class="alert alert-success mb-0 p-2 font-small" role="alert">
            <strong>MỚI :</strong> Tính năng chỉnh sửa đơn hàng hiện đã bảo trì xong.
        </div>
        <div class="alert alert-primary mb-0 p-2 font-small" role="alert">
            <strong>CẬP NHẬT :</strong> Thêm tính năng tạo lại đơn hàng (Đối với đơn hàng đã bị từ chối). Xem hướng dẫn tại mục<a href="/crm/cong-tac-trinh-duoc/huong-dan-crm" class="alert-link"> HƯỚNG DẪN CRM</a>.
        </div>
        <div class="w3-content w3-padding box p-2" style="background-color:white;">
            <div class="w3-row">
                <div class="card-header"><strong><i class="fa fa-user pr-2"></i> ĐƠN HÀNG CỦA TÔI</strong></div>
                <div class="form-group col-lg-12 col-md-12 mb-0 p-0">
                    <label class="col-form-label" for="formGroupExampleInput">Lọc trạng thái</label>
                    <select id="loctrangthai" class="selectpicker">
                        <option value="1">TẤT CẢ</option>
                        <option value="2" data-icon="fa fa-check-circle text-success fa-2x pr-2">ĐÃ DUYỆT</option>
                        <option value="3" data-icon="fa fa-exclamation-triangle text-warning fa-2x pr-1">CHỜ DUYỆT</option>
                        <option value="4" data-icon="fa fa-times-circle text-danger fa-2x pr-2">TỪ CHỐI</option>
                    </select>
                </div>
                <table id="example23" class="display nowrap table table-hover table-bordered w-100 pt-0 mb-1">
                    <thead style="background-color:rgb(66, 133, 244);">
                        <tr class="text-white">
                            <th>Số ĐH</th>
                            <th>Ngày đặt</th>
                            <th>Tên khách hàng</th>
                            <th hidden>Người tạo</th>
                            <th class="no-sort">Trạng thái</th>
                            <th class="no-sort"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            foreach (var i in Model.ListDDH.Where(n => n.USERTAO.ToUpper() == User.Identity.Name.ToUpper()).OrderByDescending(d => @Int32.Parse(d.MADH)))
                            {
                                <tr>
                                    <td class="text-center" data-id="@i.MADH">@Int32.Parse(i.MADH)</td>
                                    <td class="text-center">@i.NgayDat.ToString("dd/MM/yyyy")</td>
                                    <td>@i.DONVI</td>
                                    <td hidden>@i.USERTAO</td>
                                    @if (i.DUYETDH == false)
                                    {
                                        <td class="text-center" title="Chờ duyệt"><span hidden>3</span><i class="fa fa-exclamation-triangle fa-2x" style="color:orange;" aria-hidden="true"></i></td>
                                        <td class="text-center">
                                            <div class="dropdown">
                                                <button class="btn btn-primary waves-effect" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <i class="fa fa-angle-down pl-1 pr-1"></i>
                                                </button>
                                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu2">
                                                    @*<button class="dropdown-item btnsuahd" type="button">Thay đổi</button>*@
                                                    <button class="dropdown-item btnxemhd" type="button">Xem</button>
                                                    <button class="dropdown-item btnxoahd" type="button">Xóa</button>
                                                </div>
                                            </div>
                                        </td>
                                    }
                                    else if (i.DUYETDH == null)
                                    {
                                        <td class="text-center" title="Từ chối"><span hidden>4</span><i class="fa fa-times-circle fa-2x" style="color:red;" aria-hidden="true"></i></td>
                                        <td class="text-center"><button type="button" class="btn btn-sm btn-primary waves-effect transition-3d-hover btnxemhd m-0"><i class="fa fa-2x fa-eye"></i></button></td>
                                    }
                                    else if (i.DUYETDH == true)
                                    {
                                        <td class="text-center" title="Đã duyệt"><span hidden>2</span><i class="fa fa-check-circle fa-2x" style="color:#228117;" aria-hidden="true"></i></td>
                                        <td class="text-center"><button type="button" class="btn btn-sm btn-primary waves-effect transition-3d-hover btnxemhd m-0"><i class="fa fa-2x fa-eye"></i></button></td>
                                    }
                                </tr>
                            }
                        }
                    </tbody>
                    <!--Table body-->
                </table>
            </div>
        </div>
        <div class="w3-content w3-padding box p-2 mt-2" style="background-color:white;">
            <div class="w3-row">
                <div class="card-header"><strong><i class="fa fa-users pr-2"></i> QUẢN LÝ ĐƠN HÀNG CỦA CÁC TDV</strong></div>
                <div class="form-group col-lg-12 col-md-12 mb-0 p-0">
                    <label class="col-form-label" for="formGroupExampleInput">Lọc trạng thái</label>
                    <select id="loctrangthai1" class="selectpicker">
                        <option value="1">TẤT CẢ</option>
                        <option value="2" data-icon="fa fa-check-circle text-success fa-2x pr-2">ĐÃ DUYỆT</option>
                        <option value="3" data-icon="fa fa-exclamation-triangle text-warning fa-2x pr-1">CHỜ DUYỆT</option>
                        <option value="4" data-icon="fa fa-times-circle text-danger fa-2x pr-2">TỪ CHỐI</option>
                    </select>
                </div>
                <table id="example24" class="display nowrap table table-hover table-bordered w-100 pt-0 mb-1">
                    <!--Table head-->
                    <thead style="background-color:rgb(66, 133, 244);">
                        <tr class="text-white">
                            <th>Số ĐH</th>
                            <th>Ngày đặt</th>
                            <th>Tên khách hàng</th>
                            <th>Người tạo</th>
                            <th class="no-sort">Trạng thái</th>
                            <th class="no-sort"></th>
                        </tr>
                    </thead>

                    <tbody>
                        @{
                            foreach (var i in Model.ListDDH.Where(n => n.USERTAO.ToUpper() != User.Identity.Name.ToUpper()).OrderByDescending(d => @Int32.Parse(d.MADH)))
                            {
                                <tr>
                                    <td class="text-center" data-id="@i.MADH">@Int32.Parse(i.MADH)</td>
                                    <td class="text-center">@i.NgayDat.ToString("dd/MM/yyyy")</td>
                                    <td>@i.DONVI</td>
                                    <td>@i.USERTAO</td>
                                    @if (i.DUYETDH == false)
                                    {
                                        <td class="text-center" title="Chờ duyệt"><span hidden>3</span><i class="fa fa-exclamation-triangle fa-2x" style="color:orange;" aria-hidden="true"></i></td>
                                        <td class="text-center"><button type="button" class="btn btn-sm btn-primary waves-effect transition-3d-hover btnxemhd m-0"><i class="fa fa-2x fa-eye"></i></button></td>
                                    }
                                    else if (i.DUYETDH == null)
                                    {
                                        <td class="text-center" title="Từ chối"><span hidden>4</span><i class="fa fa-times-circle fa-2x" style="color:red;" aria-hidden="true"></i></td>
                                        <td class="text-center"><button type="button" class="btn btn-sm btn-primary waves-effect transition-3d-hover btnxemhd m-0"><i class="fa fa-2x fa-eye"></i></button></td>
                                    }
                                    else if (i.DUYETDH == true)
                                    {
                                        <td class="text-center" title="Đã duyệt"><span hidden>2</span><i class="fa fa-check-circle fa-2x" style="color:#228117;" aria-hidden="true"></i></td>
                                        <td class="text-center"><button type="button" class="btn btn-sm btn-primary waves-effect transition-3d-hover btnxemhd m-0"><i class="fa fa-2x fa-eye"></i></button></td>
                                    }
                                </tr>
                            }
                        }
                    </tbody>
                    <!--Table body-->
                </table>
            </div>
        </div>
    }
</div>
<div class="modal fade" id="ModalEdit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered fadeInDown scrollable-auto-y mt-md-auto" style="max-width:1280px" role="document">
        <div class="modal-content">
            <div class="modal-header p-2">
                <h6 class="modal-title font-weight-bold p-2">Thông tin đơn hàng&nbsp; <span class="text-danger" id="editdonhang"></span></h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="card mb-0">
                <div class="card-header">
                    Ngày đặt:
                    <strong id="editngaydat"></strong>
                    <span class="float-right"> <strong>Trạng thái:</strong> Chờ duyệt</span>
                </div>
                <div class="alert alert-primary mb-0 p-2 font-small" role="alert">
                    <strong>THÔNG BÁO :</strong> Các sản phẩm <strong>60.P53-PYME ABZ, 60.P41-PYME FUCAN, 60.T07-TATACA</strong> đơn vị tính trong mục CHỈNH SỬA TRÊN MỌI THIẾT BỊ sẽ là đơn vị <strong>VIÊN</strong>.
                </div>
                <div class="card-body p-2">
                    <div class="row mb-1">
                        <div class="col-sm-12 col-md-12 col-lg-9">
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-md-12 col-lg-12 col-form-label" for="editkhachhang">Khách hàng<code class="bg-white">(*)</code></label>
                                <div class="col-sm-12 col-lg-12">
                                    <input readonly class="form-control font-weight-normal m-0" id="editkhachhang" type="text" autocomplete="off">
                                </div>
                            </div>
                            <!-- Default input -->
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-3">
                            <!-- Default input -->
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-lg-12 col-form-label" for="editngaygiao">Dự kiến giao</label>
                                <div class="col-sm-9 col-lg-12">
                                    <input class="form-control NGAY font-weight-normal m-0" id="editngaygiao" placeholder="DD/MM/YYYY" type="text" data-validation="digit" data-inputmask="'alias': 'dd/mm/yyyy'" data-mask="" autocomplete="off">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-5">
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-lg-12 col-form-label" for="editkhuyenmai">Chương trình khuyến mãi</label>
                                <div class="col-sm-9 col-lg-12">
                                    <select id="editkhuyenmai" title="Chọn chương trình khuyến mãi" class="selectpicker" data-live-search="true" name="option">
                                        @foreach (var i in Model.ListCTKM)
                                        {
                                            <option data-bbtt="@i.BBTT" data-hanmuc="@((i.HANMUC != null)?String.Format("{0:0.##}", i.HANMUC):null)" data-tichdiem="@i.TICHDIEM" data-mahh="@i.MAHH" data-tokens="@i.MACTKM - @i.TENCTKM" data-ck="@((i.ck != null)?i.ck:0)" tabindex="@i.TENCTKM" value="@i.MACTKM">@i.MACTKM - @i.TENCTKM</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-4">
                            <div class="form-group mb-2">
                                <label class="col-form-label" for="editcthotro">Chương trình hỗ trợ</label>
                                <select id="editcthotro" title="Chọn chương trình hỗ trợ" class="selectpicker" data-live-search="true" name="option">
                                    <option selected>Không</option>
                                    @foreach (var i in Model.ListCTHT)
                                    {
                                        <option data-mactkm="@i.MACTKM" data-hanmuc="@((i.HANMUC != null)?String.Format("{0:0.##}", i.HANMUC):null)" data-tichdiem="@i.TICHDIEM" data-mahh="@i.MAHH" data-tokens="@i.MACTHT - @i.TENCTHT" tabindex="@i.TENCTHT" value="@i.MACTHT">@i.MACTHT - @i.TENCTHT</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-3">
                            <!-- Default input -->
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-lg-12 col-form-label" for="editvat">VAT</label>
                                <div class="col-sm-9 col-lg-12">
                                    <select id="editvat" class="selectpicker" name="option">
                                        <option value="5" selected>5%</option>
                                        <option value="8">8%</option>
                                        <option value="10">10%</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div class="btn-group mb-2 w-100" id="themkhachhang">
                                <span class="input-group-text btn-primary" id="basic-addon1">THÊM HÀNG HÓA</span>
                                <select title="Chọn các sản phẩm" id="themsanpham" class="selectpicker selectui" data-live-search="true" name="option" multiple data-selected-text-format="count">
                                    @foreach (var i in Model.ListHH)
                                    {
                                        if (i.phanphoi == 1)
                                        {
                                            <option disabled data-dvt="@i.DVT" data-tenhh="@i.TENHH" title="@i.MAHH - @i.TENHH" data-subtext="@i.ghichu" data-kiemsoat="@i.kiemsoat" data-giaban="@i.GIABAN" data-sl1="@i.SL1" data-sl2="@i.SL2" data-sl3="@i.SL3" value="@i.MAHH">@i.MAHH - @i.TENHH</option>
                                        }
                                        else
                                        {
                                            <option data-dvt="@i.DVT" data-tenhh="@i.TENHH" title="@i.MAHH - @i.TENHH" data-subtext="(@i.QUICACH)(@i.DVT)@((i.kiemsoat == 1)?" - (*KSĐB)":"")@((i.kiemsoat == 2) ? " - (*TPCN)":"")" data-kiemsoat="@i.kiemsoat" data-giaban="@i.GIABAN" data-sl1="@i.SL1" data-sl2="@i.SL2" data-sl3="@i.SL3" value="@i.MAHH">@i.MAHH - @i.TENHH</option>
                                        }
                                    }
                                </select>
                                <button title="Thêm" id="add_row_them" class="btn btn-sm btn-primary waves-effect pull-left m-0" style="font-size:0.7rem"><i style="font-size:1.7em" class="fa fa-plus"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive-sm">
                        <table id="tablehanghoaedit" class="table table-hover table-responsive-md table-fixed table-bordered mb-2">
                            <thead style="background-color:rgb(66, 133, 244)">
                                <tr class="text-white">
                                    <th style="width:50px;" class="center">STT</th>
                                    <th style="width:350px;">Sản phẩm</th>
                                    <th style="width:100px">Thùng</th>
                                    <th style="width:100px">Hộp</th>
                                    <th style="width:100px">Số lượng</th>
                                    <th>Đơn giá (Có VAT)</th>
                                    <th>Thành tiền</th>
                                    <th style="width:100px">Chiết khấu(%)</th>
                                    <th>Điểm tích lũy</th>
                                    <th style="width:20px;"></th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <table class="table table-bordered mb-2">
                        <tbody>
                            <tr>
                                <td class="font-weight-bold w-15 text-center text-dark">TỔNG ĐIỂM TÍCH LŨY</td>
                                <td class="text-danger font-weight-bold text-right" id="tongdiemtichluyedit">0</td>
                                <td class="font-weight-bold w-15 text-center text-dark">TIỀN VAT</td>
                                <td class="text-danger font-weight-bold text-right" id="tienvatedit">0.00</td>
                                <td class="font-weight-bold w-15 text-center text-dark">THÀNH TIỀN CHƯA VAT</td>
                                <td class="text-danger font-weight-bold text-right" id="thanhtienedit">0.00</td>
                                <td class="font-weight-bold w-15 text-center text-dark">TIỀN CK</td>
                                <td class="text-danger font-weight-bold text-right" id="tienckedit">0.00</td>
                                <td class="font-weight-bold w-15 text-center text-dark">TỔNG TIỀN</td>
                                <td class="text-danger font-weight-bold text-right" id="tongtienedit">0.00</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="form-group mb-0">
                        <textarea placeholder="Ghi chú" class="form-control rounded-0" id="editghichu" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer mb-0 mt-0 p-2">
                    <button type="button" class="btn btn-danger btn-sm transition-3d-hover mb-0" data-dismiss="modal">Đóng</button>
                    <button id="btnluu" type="button" class="btn btn-success btn-sm transition-3d-hover">Lưu</button>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="modal fade" id="ModalView" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered scrollable-auto-y mt-md-auto" style="max-width:1280px" role="document">
        <div class="modal-content">
            <div class="modal-header p-2">
                <h6 class="modal-title font-weight-bold p-2">Thông tin đơn hàng&nbsp;<span class="text-danger" id="viewdonhang"></span></h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="card mb-0">
                <div class="card-header">
                    Ngày đặt hàng:
                    <strong id="viewngaydat"></strong>
                    <span class="float-right"> <strong>Trạng thái : </strong> <span id="trangthai"></span></span>
                </div>
                <div class="card-body p-3">
                    <div class="row mb-2">
                        <div class="col-sm-12 col-md-12 col-lg-9">
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-md-3 col-lg-12 col-form-label" for="viewkhachhang">Khách hàng</label>
                                <div class="col-sm-9 col-md-9 col-lg-12">
                                    <input readonly type="text" class="form-control" id="viewkhachhang" placeholder="Chọn khách hàng">
                                </div>
                            </div>

                            <!-- Default input -->
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-3">
                            <!-- Default input -->
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-lg-12 col-form-label" for="editngaygiao">Dự kiến giao</label>
                                <div class="col-sm-9 col-lg-12">
                                    <input readonly class="form-control" id="viewngaygiao" placeholder="DD/MM/YYYY" type="text" data-validation="digit" autocomplete="off">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-5">
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-lg-12 col-form-label" for="viewkhuyenmai">Chương trình khuyến mãi</label>
                                <div class="col-sm-9 col-lg-12">
                                    <input readonly type="text" class="form-control" id="viewkhuyenmai" placeholder="Chương trình khuyến mãi">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-4">
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-lg-12 col-form-label" for="viewkhuyenmai">Chương trình hỗ trợ</label>
                                <div class="col-sm-9 col-lg-12">
                                    <input readonly type="text" class="form-control" id="viewctht" placeholder="Chương trình hỗ trợ">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-3">
                            <!-- Default input -->
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-lg-12 col-form-label" for="vat">VAT</label>
                                <div class="col-sm-9 col-lg-12">
                                    <input readonly class="form-control" id="viewvat" type="text" autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive-sm">
                        <table id="tablehanghoaview" class="table table-hover table-responsive-md table-fixed table-bordered mb-2">
                            <thead style="background-color:rgb(66, 133, 244)">
                                <tr class="text-white">
                                    <th style="width:50px;" class="center">STT</th>
                                    <th style="width:350px">Sản phẩm</th>
                                    <th class="center">Thùng</th>
                                    <th class="center">Hộp</th>
                                    <th style="width:150px" class="center">Số lượng</th>
                                    <th style="width:100px" class="center">Đơn giá (Có VAT)</th>
                                    <th style="width:100px" class="center">Thành tiền</th>
                                    <th style="width:100px">Chiết khấu(%)</th>

                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <p><strong>Ghi chú :</strong> Ký hiệu <span style="font-size:11px;" class="badge badge-danger mt-2 mb-0">&nbsp;&nbsp;</span> Sản phẩm bị từ chối</p>
                    </div>



                    <div class="container-fluid p-0">
                        <table class="table table-bordered mb-0">
                            <tbody>
                                <tr>
                                    <td class="font-weight-bold w-15 text-center text-dark">TỔNG ĐIỂM TÍCH LŨY</td>
                                    <td class="text-danger font-weight-bold text-right" id="tongdiemtichluyview">0</td>
                                    <td class="font-weight-bold w-15 text-center text-dark">TIỀN VAT</td>
                                    <td class="text-danger font-weight-bold text-right" id="tienvatview">0.00</td>
                                    <td class="font-weight-bold w-15 text-center text-dark">THÀNH TIỀN CHƯA VAT</td>
                                    <td class="text-danger font-weight-bold text-right" id="thanhtienview">0.00</td>
                                    <td class="font-weight-bold w-15 text-center text-dark">TIỀN CK</td>
                                    <td class="text-danger font-weight-bold text-right" id="tienckview">0.00</td>
                                    <td class="font-weight-bold w-15 text-center text-dark">TỔNG TIỀN</td>
                                    <td class="text-danger font-weight-bold text-right" id="tongtienview">0.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="row pt-1 pr-3 pl-3" id="divghichu">
                        <div class="form-group w-100 mb-0">
                            <label class="col-form-label" for="viewghichu">Ghi chú</label>
                            <textarea readonly class="form-control" id="viewghichu" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="row pt-1 pr-3 pl-3" id="divlido">
                        <div class="form-group w-100 mb-0">
                            <label class="col-form-label" for="ghichu">Lí do</label>
                            <textarea readonly class="form-control" id="viewlido" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="card-footer modal-footer p-2">
                    <button id="btntaolai" data-toggle="modal" data-target="#modaltaolai" type="button" class="btn btn-success btn-sm transition-3d-hover mb-0">Tạo lại đơn hàng</button>
                    <button type="button" class="btn btn-primary btn-sm transition-3d-hover" data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
</div>
@*MOBILE*@
<div class="modal fade" id="ModalEditMobile" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered fadeInDown scrollable-auto-y mt-md-auto" style="max-width:1280px" role="document">
        <div class="modal-content">
            <div class="modal-header p-2">
                <h6 class="modal-title font-weight-bold p-2">Thông tin đơn hàng&nbsp;<span class="text-danger" id="editdonhangmobile"></span></h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="card mb-0">
                <div class="card-header font-small">
                    Ngày đặt:
                    <strong id="editngaydatmobile"></strong>
                    <span class="float-right"><strong>Trạng thái:</strong> Chờ duyệt</span>
                </div>
                <div class="alert alert-primary mb-0 p-2 font-small" role="alert">
                    <strong>THÔNG BÁO :</strong> Các sản phẩm <strong>60.P53-PYME ABZ, 60.P41-PYME FUCAN, 60.T07-TATACA</strong> đơn vị tính trong mục CHỈNH SỬA TRÊN MỌI THIẾT BỊ sẽ là đơn vị <strong>VIÊN</strong>.
                </div>
                <div class="card-body pr-2 pl-2 pt-0">
                    <div class="row mb-1">
                        <div class="col-sm-12 col-md-12 col-lg-7">
                            <div class="form-group row mb-0">
                                <label class="col-sm-3 col-md-3 col-lg-4 col-form-label" for="khachhang">Khách hàng<code class="bg-white">(*)</code></label>
                                <div class="col-sm-9 col-lg-8">
                                    <input readonly class="form-control font-weight-normal m-0" id="khachhang" type="text" autocomplete="off">
                                </div>
                            </div>
                            <!-- Default input -->
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-7">
                            <div class="form-group row mb-0">
                                <label class="col-sm-3 col-lg-4 col-form-label" for="khuyenmai">Chương trình khuyến mãi</label>
                                <div class="col-sm-9 col-lg-8">
                                    <select id="khuyenmai" title="Chọn chương trình khuyến mãi" class="selectpicker" data-live-search="true" name="option">
                                        @foreach (var i in Model.ListCTKM)
                                        {
                                            <option data-bbtt="@i.BBTT" data-hanmuc="@((i.HANMUC != null)?String.Format("{0:0.##}", i.HANMUC):null)" data-tichdiem="@i.TICHDIEM" data-ck="@i.ck" data-mahh="@i.MAHH" data-tokens="@i.MACTKM - @i.TENCTKM" tabindex="@i.TENCTKM" value="@i.MACTKM">@i.MACTKM - @i.TENCTKM</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-6">
                            <div class="form-group row mb-0">
                                <label class="col-sm-3 col-lg-4 col-form-label" for="cthotro">Chương trình hỗ trợ</label>
                                <div class="col-sm-9 col-md-9 col-lg-8">
                                    <select id="cthotro" title="Chọn chương trình hỗ trợ" class="selectpicker" data-live-search="true" name="option">
                                        <option selected>Không</option>
                                        @foreach (var i in Model.ListCTHT)
                                        {
                                            <option data-mactkm="@i.MACTKM" data-hanmuc="@((i.HANMUC != null)?String.Format("{0:0.##}", i.HANMUC):null)" data-tichdiem="@i.TICHDIEM" data-mahh="@i.MAHH" data-tokens="@i.MACTHT" tabindex="@i.TENCTHT" value="@i.MACTHT">@i.MACTHT - @i.TENCTHT</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-12 col-lg-5">
                            <!-- Default input -->
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-lg-4 col-form-label" for="ngaygiao">Dự kiến giao</label>
                                <div class="col-sm-9 col-lg-8">
                                    <input class="form-control NGAY font-weight-normal m-0" id="ngaygiao" placeholder="DD/MM/YYYY" type="text" data-validation="digit" data-inputmask="'alias': 'dd/mm/yyyy'" data-mask="" autocomplete="off">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-12 col-lg-5">
                            <!-- Default input -->
                            <div class="form-group row mb-2">
                                <label class="col-sm-3 col-lg-4 col-form-label" for="vat">VAT</label>
                                <div class="col-sm-9 col-lg-8">
                                    <select id="vat" class="selectpicker" name="option">
                                        <option value="5" selected>5%</option>
                                        <option value="8">8%</option>
                                        <option value="10">10%</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 m-0">
                            <!-- Default input -->
                            <button id="btnthemhh" type="button" data-toggle="modal" data-target="#modalhh" class="btn btn-success btn-sm transition-3d-hover w-100 m-0"><i class="fa fa-plus"></i> THÊM SẢN PHẨM</button>
                        </div>
                    </div>
                    <div class="table-responsive-sm">
                        <table id="tablehanghoa" class="table table-hover table-responsive-md table-fixed table-bordered mb-2">
                            <thead style="background-color:rgb(66, 133, 244)">
                                <tr class="text-white">
                                    <th>Sản phẩm</th>
                                    <th style="width:10%">Thùng</th>
                                    <th style="width:10%">Hộp</th>
                                    <th style="width:10%">SL</th>
                                    <th>Giá</th>
                                    <th hidden>Thành tiền</th>
                                    <th style="width:10%">CK</th>
                                    <th hidden>Điểm tích lũy</th>
                                    <th style="width:20px;"></th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <table class="table table-bordered mb-2">
                        <tbody>
                            <tr>
                                <td class="font-weight-bold w-40 text-center text-dark">SL SẢN PHẨM</td>
                                <td class="text-danger font-weight-bold text-right w-60" id="slsp">0</td>
                            </tr>
                            <tr>
                                <td class="font-weight-bold w-40 text-center text-dark">TỔNG ĐIỂM TÍCH LŨY</td>
                                <td class="text-danger font-weight-bold text-right w-60" id="tongdiemtichluy">0</td>
                            </tr>
                            <tr>
                                <td class="font-weight-bold w-40 text-center text-dark">TIỀN VAT</td>
                                <td class="text-danger font-weight-bold text-right w-60" id="tienvat">0.00</td>
                            </tr>
                            <tr>
                                <td class="font-weight-bold w-40 text-center text-dark">THÀNH TIỀN CHƯA VAT</td>
                                <td class="text-danger font-weight-bold text-right w-60" id="thanhtien">0.00</td>
                            </tr>

                            <tr>
                                <td class="font-weight-bold w-40 text-center text-dark">TIỀN CK</td>
                                <td class="text-danger font-weight-bold text-right w-60" id="tienck">0.00</td>
                            </tr>
                            <tr>
                                <td class="font-weight-bold w-40 text-center text-dark">TỔNG TIỀN</td>
                                <td class="text-danger font-weight-bold text-right w-60" id="tongtien">0.00</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="form-group mb-0">
                        <textarea placeholder="Ghi chú" class="form-control rounded-0" id="ghichu" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer mb-0 mt-0 p-2">
                    <button type="button" class="btn btn-danger btn-sm transition-3d-hover mb-0" data-dismiss="modal">Đóng</button>
                    <button id="btnluumobile" type="button" class="btn btn-success btn-sm transition-3d-hover">Lưu</button>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="modal fade" id="ModalViewMobile" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered scrollable-auto-y mt-md-auto" style="max-width:1280px" role="document">
        <div class="modal-content">
            <div class="modal-header p-2">
                <h6 class="modal-title font-weight-bold p-2">Thông tin đơn hàng&nbsp;<span class="text-danger" id="viewdonhangmobile"></span></h6>

                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="card mb-0">
                <div class="card-header p-2 text-center font-small">
                    <strong>Ngày đặt : </strong>
                    <strong id="viewngaydatmobile"></strong>
                </div>
                <div class="card-header p-2 text-center font-small">
                    <strong>Trạng thái : <span id="trangthaimobile"></span></strong>
                </div>
                <div class="card-body pt-0 pr-2 pl-2">
                    <div class="row mb-2">
                        <div class="col-sm-12 col-md-6 col-lg-7">
                            <div class="form-group row mb-0">
                                <label class="col-sm-4 col-md-12 col-lg-4 col-form-label" for="viewkhachhang">Khách hàng</label>
                                <div class="col-sm-8 col-md-12 col-lg-8">
                                    <input readonly type="text" class="form-control" id="viewkhachhangmobile" placeholder="Chọn khách hàng">
                                </div>
                            </div>
                            <!-- Default input -->
                        </div>

                        <div class="col-sm-12 col-md-6 col-lg-7">
                            <div class="form-group row mb-0">
                                <label class="col-sm-4 col-md-12 col-lg-5 col-form-label" for="viewkhuyenmai">Chương trình khuyến mãi</label>
                                <div class="col-sm-8 col-md-12 col-lg-7">
                                    <input readonly type="text" class="form-control" id="viewkhuyenmaimobile" placeholder="Chương trình khuyến mãi">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-7">
                            <div class="form-group row mb-0">
                                <label class="col-sm-4 col-md-12 col-lg-5 col-form-label" for="viewcthtmobile">Chương trình hỗ trợ</label>
                                <div class="col-sm-8 col-md-12 col-lg-7">
                                    <input readonly type="text" class="form-control" id="viewcthtmobile" placeholder="Chương trình hỗ trợ">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-12 col-lg-5">
                            <!-- Default input -->
                            <div class="form-group row mb-0">
                                <label class="col-sm-4 col-lg-4 col-form-label" for="viewngaygiaomobile">Dự kiến giao</label>
                                <div class="col-sm-8 col-lg-8">
                                    <input readonly class="form-control" id="viewngaygiaomobile" placeholder="DD/MM/YYYY" type="text" data-validation="digit" autocomplete="off">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-12 col-lg-5">
                            <!-- Default input -->
                            <div class="form-group row mb-0">
                                <label class="col-sm-4 col-lg-4 col-form-label" for="vat">VAT</label>
                                <div class="col-sm-8 col-lg-8">
                                    <input readonly class="form-control" id="viewvatmobile" type="text" autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                    <table id="tablehanghoaviewmobile" class="table table-hover table-fixed table-bordered mb-2">
                        <thead style="background-color:rgb(66, 133, 244)">
                            <tr class="text-white">
                                <th>Sản phẩm</th>
                                <th class="center">Thùng</th>
                                <th class="center">Hộp</th>
                                <th class="center">Quy đổi</th>
                                <th class="center">Thành tiền</th>
                                <th class="center">CK</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <div class="container-fluid p-0">
                        <table class="table table-bordered mb-0">
                            <tbody>
                                <tr>
                                    <td class="font-weight-bold w-40 text-center text-dark">SL SẢN PHẨM</td>
                                    <td class="text-danger font-weight-bold text-right w-60" id="slspviewmobile">0</td>
                                </tr>
                                <tr>
                                    <td class="font-weight-bold w-40 text-center text-dark">TỔNG ĐIỂM TÍCH LŨY</td>
                                    <td class="text-danger font-weight-bold text-right w-60" id="tongdiemtichluyviewmobile">0</td>
                                </tr>
                                <tr>
                                    <td class="font-weight-bold w-40 text-center text-dark">TIỀN VAT</td>
                                    <td class="text-danger font-weight-bold text-right w-60" id="tienvatviewmobile">0.00</td>
                                </tr>
                                <tr>
                                    <td class="font-weight-bold w-40 text-center text-dark">THÀNH TIỀN CHƯA VAT</td>
                                    <td class="text-danger font-weight-bold text-right w-60" id="thanhtienviewmobile">0.00</td>
                                </tr>

                                <tr>
                                    <td class="font-weight-bold w-40 text-center text-dark">TIỀN CK</td>
                                    <td class="text-danger font-weight-bold text-right w-60" id="tienckviewmobile">0.00</td>
                                </tr>
                                <tr>
                                    <td class="font-weight-bold w-40 text-center text-dark">TỔNG TIỀN</td>
                                    <td class="text-danger font-weight-bold text-right w-60" id="tongtienviewmobile">0.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="row pt-1 pr-3 pl-3" id="divghichu">
                        <div class="form-group w-100 mb-0">
                            <label class="col-form-label" for="viewghichumobile">Ghi chú</label>
                            <textarea readonly class="form-control" id="viewghichumobile" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="row pt-1 pr-3 pl-3" id="divlido">
                        <div class="form-group w-100 mb-0">
                            <label class="col-form-label" for="ghichu">Lí do</label>
                            <textarea readonly class="form-control" id="viewlidomobile" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="card-footer modal-footer p-2">
                    <button id="btntaolaimobile" data-toggle="modal" data-target="#modaltaolai" type="button" class="btn btn-success btn-sm transition-3d-hover mb-0">Tạo lại đơn hàng</button>
                    <button type="button" class="btn btn-primary btn-sm transition-3d-hover" data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
</div>







<div class="modal fade" id="modalhh" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog mx-auto" role="document">
        <div class="modal-content full-screen">
            <div class="modal-header p-2">
                <h6 class="modal-title font-weight-bold p-2" id="exampleModalLabel">DANH MỤC HÀNG HÓA</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-2">

                <div class="input-group mb-1">
                    <button id="btnthem" type="button" class="btn btn-sm btn-success m-0 mb-2 w-100">Thêm</button>
                    <input autocomplete="off" onkeyup="myFunction()" type="text" class="form-control font-weight-normal border-right-0" id="timkiem" placeholder="Nhập tên hoặc mã hàng cần tìm tại đây">
                    <div class="input-group-append">
                        <button class="input-group-text bg-white p-2 border-left-0" id="btnclear"><i style="font-size:20px;" class="fa text-danger fa-times"></i></button>
                    </div>
                </div>
                <div class="container-fluid pt-2" id="dmhh">
                    @foreach (var i in Model.ListHH)
                    {
                        if (i.phanphoi == 1)
                        {
                            <div class="checkbox checkbox-primary"><input disabled data-giaban="@i.GIABAN" data-kiemsoat="@i.kiemsoat" data-sl2="@i.SL2" data-sl3="@i.SL3" class="Checkboxlist2" id="@i.MAHH" type="checkbox" data-tenhh="@i.TENHH" data-dvt="@i.DVT" value="@i.MAHH" name="mahh"> <label for="@i.MAHH">@i.MAHH - @i.TENHH @(Html.Raw("<span class='badge badge-danger'>" + i.ghichu + "</span>"))</label></div>
                        }
                        else
                        {
                            <div class="checkbox checkbox-primary"><input data-giaban="@i.GIABAN" data-kiemsoat="@i.kiemsoat" data-sl2="@i.SL2" data-sl3="@i.SL3" class="Checkboxlist2" id="@i.MAHH" type="checkbox" data-tenhh="@i.TENHH" data-dvt="@i.DVT" value="@i.MAHH" name="mahh"> <label for="@i.MAHH">@i.MAHH - @i.TENHH (@i.QUICACH)(@i.DVT) @((i.kiemsoat == 1) ? Html.Raw("<span class='badge badge-danger'>KSĐB</span>") : Html.Raw(""))@((i.kiemsoat == 2) ? Html.Raw("<span class='badge badge-warning'>TPCN</span>") : Html.Raw(""))</label></div>
                        }

                    }
                </div>
            </div>
            <div class="modal-footer p-2">
                <button type="button" class="btn btn-sm btn-danger mt-0 mb-0" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
@*MOBILE*@
<div class="modal fade" id="modaltaolai" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered scrollable-auto-y" style="max-width:500px;" role="document">
        <div class="modal-content">
            <div class="modal-header p-2">
                <h6 class="modal-title p-2">BẠN CÓ CHẮC CHẮN MUỐN TẠO LẠI ĐƠN HÀNG <span id="madhtaolai" class="text-danger"></span></h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="exampleFormControlTextarea1">Ngày dự kiến giao (Nếu có)</label>
                    <input class="form-control NGAY font-weight-normal m-0" id="taolaingaygiao" placeholder="DD/MM/YYYY" type="text" data-validation="digit" data-inputmask="'alias': 'dd/mm/yyyy'" data-mask="" autocomplete="off" />
                </div>
                <div class="form-group mb-0">
                    <label for="exampleFormControlTextarea1">Ghi chú (Nếu có)</label>
                    <textarea class="form-control" id="taolaighichu" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer p-2">
                <button id="btnsubmittaolai" type="button" class="btn btn-sm btn-success mb-0">Chắn chắn</button>
                <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal">Hủy</button>
            </div>
        </div>
    </div>
</div>
@section scripts {

    <script src="~/Scripts/bootstrap-select.js?version=3"></script>
    <script src="~/Content/Order/js/lib/datatables/datatables.min.js?version=6"></script>
    <script src="~/Scripts/Danhsachdonhang.js?version=13062023"></script>
    <script>
        var table = $('#example23').DataTable({
            "columnDefs": [{
                "targets": 'no-sort',
                "orderable": false,
            }],
            "order": [],
        });
        var table1 = $('#example24').DataTable({
            "columnDefs": [{
                "targets": 'no-sort',
                "orderable": false,
            }],
            "order": [],
        });
        var Listhh = @Html.Raw(Json.Encode(Model.ListHH));
        $(document).ready(function () {
            $('#tungay1').datepicker("setDate", "@ViewBag.tungay");
            $('#denngay1').datepicker("setDate", "@ViewBag.denngay");
            $("#example23").on("click", ".btnsuahd", function () {
                if($(window).width() < 576)
                {
                    var id = $(this).closest('tr').find('td:eq(0)').data("id");
                    $.post('@Url.Action("GetEditHoaDon", "Order")', { Id: id },
                        function (data) {
                            var milli = data[0].NgayDat.replace(/\/Date\((-?\d+)\)\//, '$1');
                            var d = new Date(parseInt(milli));
                            var dformat = ("00" + d.getDate()).slice(-2) + "/" + ("00" + (d.getMonth() + 1)).slice(-2) + "/" + d.getFullYear() + " " + ("00" + d.getHours()).slice(-2) + ":" + ("00" + d.getMinutes()).slice(-2) + ":" + ("00" + d.getSeconds()).slice(-2);
                            if (data[0].NgayGiao != null) {
                                var milli1 = data[0].NgayGiao.replace(/\/Date\((-?\d+)\)\//, '$1');
                                var d1 = new Date(parseInt(milli1));
                                var dformat1 = ("00" + d1.getDate()).slice(-2) + "/" + ("00" + (d1.getMonth() + 1)).slice(-2) + "/" + d1.getFullYear();
                                $("#ngaygiao").datepicker("setDate", dformat1);
                            }
                            else {
                                $("#ngaygiao").datepicker("setDate", "");
                            }
                            $("#editdonhangmobile").html(data[0].MADH);
                            $("#tilechietkhau").html(data[0].ck);
                            $("#editngaydatmobile").html(dformat);
                            $("#tablehanghoa > tbody").empty();
                            $("#khachhang").val(data[0].MAKH + "-" + data[0].DONVI).attr("data-makh", data[0].MAKH).attr("data-donvi", data[0].DONVI).attr("data-matdv", data[0].MATDV);
                            $("#khuyenmai").val(data[0].MACTKM);
                            $("#cthotro").val(data[0].MACTHT);
                            $("#vat").val(data[0].VAT);
                            $("#ghichu").val(data[0].GHICHU);
                            $('.selectpicker').selectpicker('refresh');
                            var float = (data[0].VAT / (100 + data[0].VAT));
                            for (var i = 0; i < data.length; i++) {
                                var modelx = Listhh.find(n=>n.MAHH == data[i].MAHH);
                                    $('#tablehanghoa > tbody').append('<tr>'
                                    + '<td class="left strong hanghoa text-dark" data-dvt="' + data[i].DVT + '" data-kiemsoat="' + data[i].NGUOIDUYET + '" data-tenhh="' + data[i].TENHH + '" data-mahh="' + data[i].MAHH + '">' + data[i].MAHH + " - " + data[i].TENHH + '</td>'
                                        + '<td class="text-right paddingleft2 paddingright2"><input autocomplete="off" onkeypress="validate(event)" data-sl="1" name="number" value="'+ ((data[i].SOLUONG3 != null)?data[i].SOLUONG3:"") +'" type="text" class="form-control form-control-sm floatright font-weight-normal text-right sl sl1"></td>'
                                        + '<td class="text-right paddingleft2 paddingright2"><input autocomplete="off" onkeypress="validate(event)" data-sl="' + modelx.SL2 + '" name="number" value="'+ ((data[i].SOLUONG2 != null)?data[i].SOLUONG2:"") +'"  type="text" class="form-control form-control-sm floatright font-weight-normal text-right sl sl2"></td>'
                                        + '<td class="text-right paddingleft2 paddingright2"><input autocomplete="off" onkeypress="validate(event)" data-sl="' + modelx.SL3 + '" name="number" value="' + ((data[i].SOLUONG != null) ? data[i].SOLUONG : "") +'"  type="text" class="form-control form-control-sm floatright font-weight-normal text-right sl sl3"></td>'
                                        + '<td class="text-right paddingleft2 paddingright2 text-dark">'
                                        + '<select class="form-control form-control-sm giaban_vat" data-id=' + i + '>'
                                        + '<option value="' + parseInt(modelx.GIABAN.replace(/[^\d.]/g, '')).format() + '">'
                                        + parseInt(modelx.GIABAN.replace(/[^\d.]/g, '')).format()
                                        + '</option>'
                                        + '<option value="0.00">0'
                                        + '</option>'
                                        + '</select>'
                                        + '</td>'
                                        + '<td class="text-right paddingleft2 paddingright2 text-dark"><input autocomplete="off" name="number" type="text" class="form-control form-control-sm floatright font-weight-normal text-right ck" value="' + data[i].ck + '"></td>'
                                   + '<td class="paddingleft2 paddingright2 text-center"><button type="button" class="btn btn-sm btn-danger waves-effect transition-3d-hover btnxoahh"><i class="fa fa-2x fa-times"></i></button></td>'
                                    + '</tr>');
                                $("#tablehanghoa .giaban_vat[data-id='" + i + "']").val(data[i].GIABAN_VAT.format())
                            }
                            var tichdiem = 0;
                            $('#tablehanghoa > tbody  > tr').each(function () {
                                var x = $(this);
                                if (typeof $("#khuyenmai option:selected").attr("data-tichdiem") != "undefined") {
                                    if($("#khuyenmai option:selected").attr("data-tichdiem") != "")
                                    {
                                        $.ajax({
                                            url: lang + '/crm/GetDiemtichluy',
                                            type: "POST",
                                            datatype: 'json',
                                            contentType: "application/json",
                                            data: '{mahh: ' + JSON.stringify(x.find(".hanghoa").attr("data-mahh")) + ', hop: ' + JSON.stringify(x.find(".sl2").val()) + ', mactkm: ' + JSON.stringify($("#khuyenmai").val()) + '}',
                                            success: function (data) {
                                                x.find(".tichdiem").text(data);
                                                tichdiem = tichdiem + parseInt(data);
                                                $("#tongdiemtichluyeditmobile").text(tichdiem);
                                            },
                                            error: function (request, status, error) {
                                                toastr.options = {
                                                    "closeButton": false,
                                                    "debug": false,
                                                    "newestOnTop": true,
                                                    "progressBar": true,
                                                    "positionClass": "toast-top-right",
                                                    "preventDuplicates": false,
                                                    "onclick": null,
                                                    "showDuration": "300",
                                                    "hideDuration": "1000",
                                                    "timeOut": "5000",
                                                    "extendedTimeOut": "1000",
                                                    "showEasing": "swing",
                                                    "hideEasing": "linear",
                                                    "showMethod": "fadeIn",
                                                    "hideMethod": "fadeOut"
                                                }
                                                Command: toastr["warning"]("Không kết nối được dữ liệu điểm tích lũy", "Thông báo")
                                            },
                                            timeout: 5000,
                                        });
                                    }
                                }
                                if (typeof $("#cthotro option:selected").attr("data-tichdiem") != "undefined") {
                                    if($("#cthotro option:selected").attr("data-tichdiem") != "")
                                    {
                                        $.ajax({
                                            url: lang + '/crm/GetDiemtichluy',
                                            type: "POST",
                                            datatype: 'json',
                                            contentType: "application/json",
                                            data: '{mahh: ' + JSON.stringify(x.find(".hanghoa").attr("data-mahh")) + ', hop: ' + JSON.stringify(x.find(".sl2").val()) + ', mactkm: ' + JSON.stringify($("#cthotro").val()) + '}',
                                            success: function (data) {
                                                x.find(".tichdiem").text(data);
                                                tichdiem = tichdiem + parseInt(data);
                                                $("#tongdiemtichluyeditmobile").text(tichdiem);
                                            },
                                            error: function (request, status, error) {
                                                toastr.options = {
                                                    "closeButton": false,
                                                    "debug": false,
                                                    "newestOnTop": true,
                                                    "progressBar": true,
                                                    "positionClass": "toast-top-right",
                                                    "preventDuplicates": false,
                                                    "onclick": null,
                                                    "showDuration": "300",
                                                    "hideDuration": "1000",
                                                    "timeOut": "5000",
                                                    "extendedTimeOut": "1000",
                                                    "showEasing": "swing",
                                                    "hideEasing": "linear",
                                                    "showMethod": "fadeIn",
                                                    "hideMethod": "fadeOut"
                                                }
                                                Command: toastr["warning"]("Không kết nối được dữ liệu điểm tích lũy", "Thông báo")
                                            },
                                            timeout: 5000,
                                        });
                                    }
                                }
                            });
                            $("#slsp").text(data.length);
                            check_gia_mobile();
                           });
                    $("#ModalEditMobile").modal({ backdrop: 'static', keyboard: false })
                }
                else
                {
                    var id = $(this).closest('tr').find('td:eq(0)').data("id");
                    $.post('@Url.Action("GetEditHoaDon", "Order")', { Id: id },
                        function (data) {
                            var milli = data[0].NgayDat.replace(/\/Date\((-?\d+)\)\//, '$1');
                            var d = new Date(parseInt(milli));
                            var dformat = ("00" + d.getDate()).slice(-2) + "/" + ("00" + (d.getMonth() + 1)).slice(-2) + "/" + d.getFullYear() + " " + ("00" + d.getHours()).slice(-2) + ":" + ("00" + d.getMinutes()).slice(-2) + ":" + ("00" + d.getSeconds()).slice(-2);
                            if (data[0].NgayGiao != null) {
                                var milli1 = data[0].NgayGiao.replace(/\/Date\((-?\d+)\)\//, '$1');
                                var d1 = new Date(parseInt(milli1));
                                var dformat1 = ("00" + d1.getDate()).slice(-2) + "/" + ("00" + (d1.getMonth() + 1)).slice(-2) + "/" + d1.getFullYear();
                                $("#editngaygiao").datepicker("setDate", dformat1);
                            }
                            else {
                                $("#editngaygiao").datepicker("setDate", "");
                            }
                            $("#editdonhang").html(data[0].MADH);
                            $("#editngaydat").html(dformat);
                            $("#tablehanghoaedit > tbody").empty();
                            $("#editkhachhang").val(data[0].MAKH + "-" + data[0].DONVI).attr("data-makh", data[0].MAKH).attr("data-donvi", data[0].DONVI).attr("data-matdv", data[0].MATDV);
                            $("#editkhuyenmai").val(data[0].MACTKM);
                            $("#editcthotro").val(data[0].MACTHT);
                            $("#editvat").val(data[0].VAT);
                            $("#editghichu").val(data[0].GHICHU);
                            $('.selectpicker').selectpicker('refresh');
                            var float = (data[0].VAT / (100 + data[0].VAT));
                            for (var i = 0; i < data.length; i++) {
                                var modelx = Listhh.find(n=>n.MAHH == data[i].MAHH);

                                    $('#tablehanghoaedit > tbody').append('<tr>'
                                    + '<td class="text-center text-dark">' + data[i].STT + '</td>'
                                    + '<td class="left strong hanghoa text-dark" data-dvt="' + data[i].DVT + '" data-kiemsoat="' + data[i].NGUOIDUYET + '" data-tenhh="' + data[i].TENHH + '" data-mahh="' + data[i].MAHH + '">' + data[i].MAHH + " - " + data[i].TENHH + '</td>'
                                    + '<td class="text-right paddingleft2 paddingright2"><input autocomplete="off" onkeypress="validate(event)" data-sl="' + modelx.SL1 + '" value="'+ ((data[i].SOLUONG3 != null)?data[i].SOLUONG3.format():"") +'"  name="number" type="text" class="form-control form-control-sm floatright font-weight-normal text-right sl sl1"></td>'
                                    + '<td class="text-right paddingleft2 paddingright2"><input autocomplete="off" onkeypress="validate(event)" data-sl="' + modelx.SL2 + '" value="'+ ((data[i].SOLUONG2 != null)?data[i].SOLUONG2.format():"") +'" name="number" type="text" class="form-control form-control-sm floatright font-weight-normal text-right sl sl2"></td>'
                                        + '<td class="text-right paddingleft2 paddingright2 text-dark"><input autocomplete="off" onkeypress="validate(event)" data-sl="' + modelx.SL3 + '" value="' + ((data[i].SOLUONG != null) ? data[i].SOLUONG.format() : "") +'" name="number" type="text" class="form-control form-control-sm floatright font-weight-normal text-right sl sl3"></td>'
                                         + '<td class="text-right paddingleft2 paddingright2 text-dark">'
                                        + '<select class="form-control form-control-sm giaban_vat" data-id='+i+'>'
                                        + '<option value="' + parseInt(modelx.GIABAN.replace(/[^\d.]/g, '')).format() + '">'
                                        + parseInt(modelx.GIABAN.replace(/[^\d.]/g, '')).format()
                                        + '</option>'
                                        + '<option value="0.00">0'
                                        + '</option>'
                                        + '</select>'
                                        + '</td>'
                                    + '<td class="text-right paddingleft2 paddingright2 text-dark">' + (data[i].GIABAN_VAT * data[i].SOLUONG).format() + '</td>'
                                        + '<td class="text-right paddingleft2 paddingright2 text-dark"><input autocomplete="off" name="number" type="text" class="form-control form-control-sm floatright font-weight-normal text-right ck" value="' + data[i].ck+'"></td>'
                                    + '<td class="text-right paddingleft2 paddingright2 text-dark">0</td>'
                                    + '<td class="paddingleft2 paddingright2 text-center"><button type="button" class="btn btn-sm btn-danger waves-effect transition-3d-hover btnxoahh"><i class="fa fa-2x fa-times"></i></button></td>'
                                    + '</tr>');
                                $("#tablehanghoaedit .giaban_vat[data-id='" + i + "']").val(data[i].GIABAN_VAT.format())

                            }
                            var count = 0;
                            var tichdiem = 0;
                            $('#tablehanghoaedit > tbody  > tr').each(function () {
                                var x = $(this);
                                count = count + parseInt($(this).find(".tichdiem").text().replace(/[^\d.]/g, ''));
                                if (typeof $("#editkhuyenmai option:selected").attr("data-tichdiem") != "undefined") {
                                    if($("#editkhuyenmai option:selected").attr("data-tichdiem") != "")
                                    {
                                        $.ajax({
                                            url: lang + '/crm/GetDiemtichluy',
                                            type: "POST",
                                            datatype: 'json',
                                            contentType: "application/json",
                                            data: '{mahh: ' + JSON.stringify(x.find(".hanghoa").attr("data-mahh")) + ', hop: ' + JSON.stringify(x.find(".sl3").val().replace(/[^\d.]/g, '') * x.find(".sl2").attr("data-sl") / x.find(".sl3").attr("data-sl")) + ', mactkm: ' + JSON.stringify($("#editkhuyenmai").val()) + '}',
                                            success: function (data) {
                                                x.find(".tichdiem").text(data);
                                                tichdiem = tichdiem + parseInt(data);
                                                $("#tongdiemtichluyedit").text(tichdiem);
                                            },
                                            error: function (request, status, error) {
                                                toastr.options = {
                                                    "closeButton": false,
                                                    "debug": false,
                                                    "newestOnTop": true,
                                                    "progressBar": true,
                                                    "positionClass": "toast-top-right",
                                                    "preventDuplicates": false,
                                                    "onclick": null,
                                                    "showDuration": "300",
                                                    "hideDuration": "1000",
                                                    "timeOut": "5000",
                                                    "extendedTimeOut": "1000",
                                                    "showEasing": "swing",
                                                    "hideEasing": "linear",
                                                    "showMethod": "fadeIn",
                                                    "hideMethod": "fadeOut"
                                                }
                                                Command: toastr["warning"]("Không kết nối được dữ liệu điểm tích lũy", "Thông báo")
                                            },
                                            timeout: 5000,
                                        });
                                    }
                                }
                                if (typeof $("#editcthotro option:selected").attr("data-tichdiem") != "undefined") {
                                    if($("#editcthotro option:selected").attr("data-tichdiem") != "")
                                    {
                                        $.ajax({
                                            url: lang + '/crm/GetDiemtichluy',
                                            type: "POST",
                                            datatype: 'json',
                                            contentType: "application/json",
                                            data: '{mahh: ' + JSON.stringify(x.find(".hanghoa").attr("data-mahh")) + ', hop: ' + JSON.stringify(x.find(".sl3").val().replace(/[^\d.]/g, '') * x.find(".sl2").attr("data-sl") / x.find(".sl3").attr("data-sl")) + ', mactkm: ' + JSON.stringify($("#editcthotro").val()) + '}',
                                            success: function (data) {
                                                x.find(".tichdiem").text(data);
                                                tichdiem = tichdiem + parseInt(data);
                                                $("#tongdiemtichluyedit").text(tichdiem);
                                            },
                                            error: function (request, status, error) {
                                                toastr.options = {
                                                    "closeButton": false,
                                                    "debug": false,
                                                    "newestOnTop": true,
                                                    "progressBar": true,
                                                    "positionClass": "toast-top-right",
                                                    "preventDuplicates": false,
                                                    "onclick": null,
                                                    "showDuration": "300",
                                                    "hideDuration": "1000",
                                                    "timeOut": "5000",
                                                    "extendedTimeOut": "1000",
                                                    "showEasing": "swing",
                                                    "hideEasing": "linear",
                                                    "showMethod": "fadeIn",
                                                    "hideMethod": "fadeOut"
                                                }
                                                Command: toastr["warning"]("Không kết nối được dữ liệu điểm tích lũy", "Thông báo")
                                            },
                                            timeout: 5000,
                                        });
                                    }


                                }
                            });
                            check_gia()
                           });
                    $("#ModalEdit").modal({ backdrop: 'static', keyboard: false })
                }
            });
           
            $("#example23").on("click", ".btnxoahd", function () {
                var id = $(this).closest('tr').find('td:eq(0)').data("id");
                $.confirm({
                    title: '<b>THÔNG BÁO</b>',
                    content: 'Bạn có chắc chắn muốn xóa đơn hàng này ?',
                    buttons: {
                        confirm: {
                            text: 'Chắc chắn',
                            btnClass: 'btn-success',
                            keys: ['enter'],
                            action: function () {
                                $.post('@Url.Action("DelHoaDon", "Order")', { Id: id},
                                function (data) {
                                    if(data != 1)
                                    {
                                        setTimeout(function () {
                                            window.location.reload();
                                        }, 300);
                                    }
                                    else
                                    {
                                        $.confirm({
                                            title: '<b>THÔNG BÁO</b>',
                                            content: 'Đơn hàng này đã được duyệt hoặc bị từ chối, không thể xóa!',
                                            buttons: {
                                                confirm: {
                                                    text: 'Đóng',
                                                    btnClass: 'btn-primary',
                                                    keys: ['enter'],
                                                    action: function () {
                                                        setTimeout(function () {
                                                            window.location.reload();
                                                        }, 300);
                                                    }
                                                }
                                            }
                                        });
                                    }
                                });
                                return false;
                            }
                        },
                        cancel: {
                            text: 'Hủy',
                            btnClass: 'btn-danger',
                            keys: ['esc'],
                            action: function () {

                            }
                        }
                    }
                });
            });
            $("#example23,#example24").on("click", ".btnxemhd", function () {
                if($(window).width() < 576)
                {
                    var id = $(this).closest('tr').find('td:eq(0)').data("id");
                    $.post('@Url.Action("GetEditHoaDon", "Order")', { Id: id },
                     function (data) {
                         var milli = data[0].NgayDat.replace(/\/Date\((-?\d+)\)\//, '$1');
                         var d = new Date(parseInt(milli));
                         var dformat = ("00" + d.getDate()).slice(-2) + "/" + ("00" + (d.getMonth() + 1)).slice(-2) + "/" + d.getFullYear() + " " + ("00" + d.getHours()).slice(-2) + ":" + ("00" + d.getMinutes()).slice(-2) + ":" + ("00" + d.getSeconds()).slice(-2);
                         if (data[0].NgayGiao != null) {
                             var milli1 = data[0].NgayGiao.replace(/\/Date\((-?\d+)\)\//, '$1');
                             var d1 = new Date(parseInt(milli1));
                             var dformat1 = ("00" + d1.getDate()).slice(-2) + "/" + ("00" + (d1.getMonth() + 1)).slice(-2) + "/" + d1.getFullYear();
                             $("#viewngaygiaomobile").val(dformat1);
                         }
                         else {
                             $("#viewngaygiaomobile").val("N/A");
                         }
                         if (data[0].DUYETDH == null) {
                             $("#viewghichumobile").val(data[0].GHICHU);
                             $("#viewlidomobile").val(data[0].LIDO);
                             $("#trangthaimobile").text("Từ chối");
                             $("#btntaolaimobile").show();
                         }
                         else if (data[0].DUYETDH == false) {
                             $("#viewghichumobile").val(data[0].GHICHU);
                             $("#trangthaimobile").text("Chờ duyệt");
                             $("#btntaolaimobile").hide();
                         }
                         else {
                             $("#viewghichumobile").val(data[data.length - 1].GHICHU);
                             $("#trangthaimobile").text("Đã duyệt - Số hóa đơn : " + data[0].SOHD);
                             $("#btntaolaimobile").hide();
                         }
                         $("#viewtilechietkhaumobile").html(data[0].ck);
                         $("#viewdonhangmobile").html(data[0].MADH);
                         $("#viewngaydatmobile").html(dformat);
                         $("#tablehanghoaviewmobile > tbody").empty();
                         $("#viewkhachhangmobile").val(data[0].MAKH + " - " + data[0].DONVI);
                         $("#viewvatmobile").val(data[0].VAT + "%");
                         var float = (data[0].VAT / (100 + data[0].VAT));
                         if (data[0].MACTKM != null) {
                             $("#viewkhuyenmaimobile").val(data[0].MACTKM + " - " + data[0].TENCTKM);

                             $.ajax({
                                 url: lang + '/crm/GetTongdiemtichluy',
                                 type: "POST",
                                 datatype: 'json',
                                 contentType: "application/json",
                                 data: '{SODH: ' + JSON.stringify(id) + ', mactkm: ' + JSON.stringify(data[0].MACTKM) + '}',
                                 success: function (data) {

                                     $("#tongdiemtichluymobile").text(data);
                                 },
                                 error: function (request, status, error) {
                                     toastr.options = {
                                         "closeButton": false,
                                         "debug": false,
                                         "newestOnTop": true,
                                         "progressBar": true,
                                         "positionClass": "toast-top-right",
                                         "preventDuplicates": false,
                                         "onclick": null,
                                         "showDuration": "300",
                                         "hideDuration": "1000",
                                         "timeOut": "5000",
                                         "extendedTimeOut": "1000",
                                         "showEasing": "swing",
                                         "hideEasing": "linear",
                                         "showMethod": "fadeIn",
                                         "hideMethod": "fadeOut"
                                     }
                                     Command: toastr["warning"]("Không kết nối được dữ liệu điểm tích lũy", "Thông báo")
                                 },
                                 timeout: 5000,
                             });
                         }
                         else {
                             $("#viewkhuyenmaimobile").val("N/A");
                             $("#tongdiemtichluymobile").text("0");
                         }
                         if (data[0].MACTHT != null) {
                             $("#viewcthtmobile").val(data[0].MACTHT);
                             $.ajax({
                                 url: lang + '/crm/GetTongdiemtichluy',
                                 type: "POST",
                                 datatype: 'json',
                                 contentType: "application/json",
                                 data: '{SODH: ' + JSON.stringify(id) + ', mactkm: ' + JSON.stringify(data[0].MACTHT) + '}',
                                 success: function (data) {

                                     $("#tongdiemtichluymobile").text(data);
                                 },
                                 error: function (request, status, error) {
                                     toastr.options = {
                                         "closeButton": false,
                                         "debug": false,
                                         "newestOnTop": true,
                                         "progressBar": true,
                                         "positionClass": "toast-top-right",
                                         "preventDuplicates": false,
                                         "onclick": null,
                                         "showDuration": "300",
                                         "hideDuration": "1000",
                                         "timeOut": "5000",
                                         "extendedTimeOut": "1000",
                                         "showEasing": "swing",
                                         "hideEasing": "linear",
                                         "showMethod": "fadeIn",
                                         "hideMethod": "fadeOut"
                                     }
                                     Command: toastr["warning"]("Không kết nối được dữ liệu điểm tích lũy", "Thông báo")
                                 },
                                 timeout: 5000,
                             });
                         }
                         else {
                             $("#viewcthtmobile").val("N/A");
                             $("#tongdiemtichluymobile").text("0");
                         }
                         for (var i = 0; i < data.length; i++) {
                                 //var modelx = Listhh.find(n=>n.MAHH == data[i].MAHH);
                                 $("#tablehanghoaviewmobile").find("tbody").append(
                                  '<tr>'// need to change closing tag to an opening `<tr>` tag.
                                + '<td class="left strong text-dark font-weight-normal">' + data[i].MAHH + " - " + data[i].TENHH + ((data[i].DUYETDH == null)?' <span style="font-size:8px;" class="badge badge-danger">Từ chối</span>':"") + '</td>'
                                  + '<td class="text-right text-dark font-weight-normal">' + ((data[i].SOLUONG3 == null)?"N/A":data[i].SOLUONG3) + '</td>'
                               + '<td class="text-right text-dark font-weight-normal">' + ((data[i].SOLUONG2 == null)?"N/A":data[i].SOLUONG2) + '</td>'
                                + '<td class="text-right text-dark font-weight-normal">' + data[i].SOLUONG.toString().split(/(?=(?:\d{3})+(?:\.|$))/g).join(",") + ' ' + data[i].DVT + '</td>'
                                  + '<td class="text-right text-dark font-weight-normal">' + (data[i].GIABAN_VAT * data[i].SOLUONG).format() + '</td>'
                                     + '<td class="text-right text-dark font-weight-normal">' + data[i].ck + '</td>'
                               + '</tr>');

                         }
                         check_gia_view_mobile(data);
                     });
                    $("#ModalViewMobile").modal({ backdrop: 'static', keyboard: false })
                }
                else
                {
                    var id = $(this).closest('tr').find('td:eq(0)').data("id");
                    $.post('@Url.Action("GetEditHoaDon", "Order")', { Id: id },
                        function (data) {
                            var milli = data[0].NgayDat.replace(/\/Date\((-?\d+)\)\//, '$1');
                            var d = new Date(parseInt(milli));
                            var dformat = ("00" + d.getDate()).slice(-2) + "/" + ("00" + (d.getMonth() + 1)).slice(-2) + "/" + d.getFullYear() + " " + ("00" + d.getHours()).slice(-2) + ":" + ("00" + d.getMinutes()).slice(-2) + ":" + ("00" + d.getSeconds()).slice(-2);
                            if (data[0].NgayGiao != null) {
                                var milli1 = data[0].NgayGiao.replace(/\/Date\((-?\d+)\)\//, '$1');
                                var d1 = new Date(parseInt(milli1));
                                var dformat1 = ("00" + d1.getDate()).slice(-2) + "/" + ("00" + (d1.getMonth() + 1)).slice(-2) + "/" + d1.getFullYear();
                                $("#viewngaygiao").val(dformat1);
                            }
                            else {
                                $("#viewngaygiao").val("N/A");
                            }
                            if (data[0].DUYETDH == null) {
                                $("#viewghichu").val(data[0].GHICHU);
                                $("#viewlido").val(data[0].LIDO);
                                $("#trangthai").text("Từ chối");
                                $("#btntaolai").show();
                            }
                            else if (data[0].DUYETDH == false) {
                                $("#viewghichu").val(data[0].GHICHU);
                                $("#trangthai").text("Chờ duyệt");
                                $("#btntaolai").hide();
                            }
                            else {
                                $("#viewghichu").val(data[data.length - 1].GHICHU);
                                $("#trangthai").text("Đã duyệt - Số hóa đơn : " + data[0].SOHD);
                                $("#btntaolai").hide();
                            }
                            $("#viewtilechietkhau").html(data[0].ck);
                            $("#viewdonhang").html(data[0].MADH);
                            $("#viewngaydat").html(dformat);
                            $("#tablehanghoaview > tbody").empty();
                            $("#viewkhachhang").val(data[0].MAKH + " - " + data[0].DONVI);
                            $("#viewvat").val(data[0].VAT + "%");
                            var float = (data[0].VAT / (100 + data[0].VAT));
                            if (data[0].MACTKM != null) {
                                $("#viewkhuyenmai").val(data[0].MACTKM + " - " + data[0].TENCTKM);
                                $.ajax({
                                    url: lang + '/crm/GetTongdiemtichluy',
                                    type: "POST",
                                    datatype: 'json',
                                    contentType: "application/json",
                                    data: '{SODH: ' + JSON.stringify(id) + ', mactkm: ' + JSON.stringify(data[0].MACTKM) + '}',
                                    success: function (data) {
                                        $("#tongdiemtichluy").text(data);
                                    },
                                    error: function (request, status, error) {
                                        toastr.options = {
                                            "closeButton": false,
                                            "debug": false,
                                            "newestOnTop": true,
                                            "progressBar": true,
                                            "positionClass": "toast-top-right",
                                            "preventDuplicates": false,
                                            "onclick": null,
                                            "showDuration": "300",
                                            "hideDuration": "1000",
                                            "timeOut": "5000",
                                            "extendedTimeOut": "1000",
                                            "showEasing": "swing",
                                            "hideEasing": "linear",
                                            "showMethod": "fadeIn",
                                            "hideMethod": "fadeOut"
                                        }
                                        Command: toastr["warning"]("Không kết nối được dữ liệu điểm tích lũy", "Thông báo")
                                    },
                                    timeout: 5000,
                                });

                            }
                            else {
                                $("#viewkhuyenmai").val("N/A");
                                $("#tongdiemtichluy").text("0");
                            }
                            if (data[0].MACTHT != null) {
                                $("#viewctht").val(data[0].MACTHT);
                                $.ajax({
                                    url: lang + '/crm/GetTongdiemtichluy',
                                    type: "POST",
                                    datatype: 'json',
                                    contentType: "application/json",
                                    data: '{SODH: ' + JSON.stringify(id) + ', mactkm: ' + JSON.stringify(data[0].MACTHT) + '}',
                                    success: function (data) {
                                        $("#tongdiemtichluy").text(data);
                                    },
                                    error: function (request, status, error) {
                                        toastr.options = {
                                            "closeButton": false,
                                            "debug": false,
                                            "newestOnTop": true,
                                            "progressBar": true,
                                            "positionClass": "toast-top-right",
                                            "preventDuplicates": false,
                                            "onclick": null,
                                            "showDuration": "300",
                                            "hideDuration": "1000",
                                            "timeOut": "5000",
                                            "extendedTimeOut": "1000",
                                            "showEasing": "swing",
                                            "hideEasing": "linear",
                                            "showMethod": "fadeIn",
                                            "hideMethod": "fadeOut"
                                        }
                                        Command: toastr["warning"]("Không kết nối được dữ liệu điểm tích lũy", "Thông báo")
                                    },
                                    timeout: 5000,
                                });
                            }
                            else {
                                $("#viewctht").val("N/A");
                                $("#tongdiemtichluy").text("0");
                            }
                            for (var i = 0; i < data.length; i++) {
                                $("#tablehanghoaview").find("tbody").append(
                                 '<tr>'// need to change closing tag to an opening `<tr>` tag.
                               + '<td class="text-center text-dark font-weight-normal">'+ data[i].STT + '</td>'
                               + '<td class="left strong text-dark font-weight-normal">' + data[i].MAHH + " - " + data[i].TENHH + " (" + data[i].DVT + ")" + ((data[i].DUYETDH == null)?' <span style="font-size:9px;" class="badge badge-danger">Từ chối</span>':"") + '</td>'
                                  + '<td class="text-right text-dark font-weight-normal">' + ((data[i].SOLUONG3 == null)?"N/A":data[i].SOLUONG3) + '</td>'
                                + '<td class="text-right text-dark font-weight-normal">' + ((data[i].SOLUONG2 == null)?"N/A":data[i].SOLUONG2) + '</td>'
                              + '<td class="text-right text-dark font-weight-normal">' + data[i].SOLUONG.format() + '</td>'
                               + '<td class="text-right text-dark font-weight-normal">' + data[i].GIABAN_VAT.format() + '</td>'
                               + '<td class="text-right text-dark font-weight-normal">' + (data[i].GIABAN_VAT * data[i].SOLUONG).format() + '</td>'
                                    + '<td class="text-right text-dark font-weight-normal">' + data[i].ck + '</td>'
                               + '</tr>');
                            }
                            check_gia_view(data);
                        });
                    $("#ModalView").modal({ backdrop: 'static', keyboard: false })
                }
            });

            $("#btnsubmittaolai").click(function(){
                $.ajax({
                    url: '@Url.Action("Taolaidonhang", "Order")',
                    headers: { '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() },
                    type: "POST",
                    datatype: 'json',
                    contentType: "application/json",
                    data: '{madh: ' + JSON.stringify($("#madhtaolai").text()) + ', ngaygiao: ' + JSON.stringify($("#taolaingaygiao").val()) + ', ghichu: ' + JSON.stringify($("#taolaighichu").val()) + '}',
                    success: function (data) {
                        if(data == 0)
                        {
                            toastr.options = {
                                "closeButton": false,
                                "debug": false,
                                "newestOnTop": true,
                                "progressBar": true,
                                "positionClass": "toast-top-right",
                                "preventDuplicates": false,
                                "onclick": null,
                                "showDuration": "300",
                                "hideDuration": "1000",
                                "timeOut": "5000",
                                "extendedTimeOut": "1000",
                                "showEasing": "swing",
                                "hideEasing": "linear",
                                "showMethod": "fadeIn",
                                "hideMethod": "fadeOut"
                            }
                            Command: toastr["warning"]("Bạn không phải là người tạo đơn hàng này, bạn không có quyền tạo lại đơn !", "Thông báo")
                        }
                        else
                        {
                            $.confirm({
                                title: '<b>THÔNG BÁO</b>',
                                content: 'Đã tạo lại thành công đơn hàng, mã đơn hàng mới là <b>' + data + '</b>.',
                                buttons: {
                                    confirm: {
                                        text: 'Đóng',
                                        btnClass: 'btn-primary',
                                        keys: ['enter'],
                                        action: function () {
                                            window.location.reload();
                                        }
                                    }

                                }
                            });
                        }
                    }
                });
            });
            //MÁY TÍNH

            $("#btnluu").click(function () {
                var prevent = 0;
                if (typeof $("#editkhuyenmai option:selected").attr("data-mahh") != "undefined") {
                    if($("#editkhuyenmai option:selected").attr("data-mahh") != "")
                    {
                        var mahhctkm = $("#editkhuyenmai option:selected").attr("data-mahh").split(",");
                        var khongthuoc = []
                        $('#tablehanghoaedit > tbody > tr').each(function () {
                            if (!mahhctkm.includes($(this).closest('tr').find('.hanghoa').attr("data-mahh"))) {
                                khongthuoc.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                            }
                        });
                        if (khongthuoc.length != 0) {
                            $.confirm({
                                title: '<b>CẢNH BÁO</b>',
                                content: 'Sản phẩm <b class="text-danger">' + khongthuoc.toString() + '</b> không nằm trong danh mục sản phẩm của CTKM <b class="text-danger">' + $("#editkhuyenmai").val() + '',
                                buttons: {
                                    cancel: {
                                        text: 'Đóng',
                                        btnClass: 'btn-blue',
                                        keys: ['enter', 'shift'],
                                        action: function () {

                                        }
                                    }
                                }
                            });
                            prevent = 1;
                            return false;
                        }
                    }
                }
                if (typeof $("#editcthotro option:selected").attr("data-mahh") != "undefined") {
                    if($("#editcthotro option:selected").attr("data-mahh") != "")
                    {
                        var mahhctht = $("#editcthotro option:selected").attr("data-mahh").split(",");
                        var khongthuocht = []
                        $('#tablehanghoaedit > tbody > tr').each(function () {
                            if (!mahhctht.includes($(this).closest('tr').find('.hanghoa').attr("data-mahh"))) {
                                khongthuocht.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                            }
                        });
                        if (khongthuocht.length != 0) {
                            $.confirm({
                                title: '<b>CẢNH BÁO</b>',
                                content: 'Sản phẩm <b class="text-danger">' + khongthuocht.toString() + '</b> không nằm trong danh mục sản phẩm của CT hỗ trợ <b class="text-danger">' + $("#editcthotro").val() + '',
                                buttons: {
                                    cancel: {
                                        text: 'Đóng',
                                        btnClass: 'btn-blue',
                                        keys: ['enter', 'shift'],
                                        action: function () {

                                        }
                                    }
                                }
                            });
                            prevent = 1;
                            return false;
                        }
                    }
                }
         if (typeof $("#editcthotro option:selected").attr("data-mactkm") != "undefined") {
            if ($("#editcthotro option:selected").attr("data-mactkm") != "") {
                var mactkmctht = $("#editcthotro option:selected").attr("data-mactkm").split(",");
                if (!mactkmctht.includes($("#editkhuyenmai").val())) {
                    $.confirm({
                        title: '<b>CẢNH BÁO</b>',
                        content: 'Chương trình hỗ trợ <b class="text-danger">' + $("#editcthotro").val() + '</b> không hỗ trợ cho CTKM <b class="text-danger">' + $("#editkhuyenmai").val() + '</b>. Vui lòng kiểm tra lại',
                        buttons: {
                            cancel: {
                                text: 'Đóng',
                                btnClass: 'btn-blue',
                                keys: ['enter', 'shift'],
                                action: function () {

                                }
                            }
                        }
                    });
                    prevent = 1;
                    return false;
                }
            }
        }
                $('#tablehanghoaedit > tbody > tr').each(function () {
                    if ($(this).find('.sl3').val() == 0 || $(this).find(".sl3").val() == "") {
                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": true,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        Command: toastr["warning"]("Xin điền đẩy đủ số lượng cho sản phẩm thứ " + $(this).find('td:eq(0)').text() + " hoặc xóa sản phẩm", "Thông báo")
                        prevent = 1;
                        return false;
                    }
                });
                if (typeof $("#editkhuyenmai option:selected").attr("data-tichdiem") != "undefined") {

                    if (parseInt($("#tongdiemtichluyedit").text()) < parseInt($("#editkhuyenmai option:selected").attr("data-tichdiem"))) {
                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": true,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        Command: toastr["warning"]("Tổng điểm tích lũy không đủ " + $("#editkhuyenmai option:selected").attr("data-tichdiem") + " điểm để tạo đơn hàng vui lòng kiểm tra lại.", "Thông báo")
                        prevent = 1;
                        return false;
                    }
                }
                var tpcn = []
                var ksdb = []
                var hh40 = []
                var hh99 = []
                $('#tablehanghoaedit > tbody > tr').each(function () {
                    if ($(this).closest('tr').find('.hanghoa').attr("data-kiemsoat") == 1) {
                        ksdb.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                    }
                    else if ($(this).closest('tr').find('.hanghoa').attr("data-kiemsoat") == 2) {
                        tpcn.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                    }
                    else if ($(this).closest('tr').find('.hanghoa').attr("data-kiemsoat") == 40) {
                        hh40.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                    }
                    else if ($(this).closest('tr').find('.hanghoa').attr("data-kiemsoat") == 99) {
                        hh99.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                    }
                });
                if ((tpcn.length != 0 && $('#tablehanghoaedit > tbody > tr').length > tpcn.length) || (ksdb.length != 0 && $('#tablehanghoaedit > tbody > tr').length > ksdb.length)) {
                    toastr.options = {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": true,
                        "progressBar": true,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }
                    Command: toastr["warning"]("Bạn vui lòng tách đơn hàng có sản phẩm <b>Kiểm soát đặc biệt - Thực phẩm chức năng hoặc Nhóm hàng 40,99</b> ra đơn hàng riêng", "Thông báo")
                    prevent = 1;
                    return false;
                }

                if (tpcn.length == 0 && ksdb.length == 0) {
                    if (typeof $("#editkhuyenmai option:selected").attr("data-hanmuc") != "undefined") {
                        if ($("#editkhuyenmai option:selected").attr("data-hanmuc") != "") {
                            if (parseInt($("#thanhtien").text().replace(/[^\d.]/g, '')) < parseInt($("#editkhuyenmai option:selected").attr("data-hanmuc"))) {
                                toastr.options = {
                                    "closeButton": false,
                                    "debug": false,
                                    "newestOnTop": true,
                                    "progressBar": true,
                                    "positionClass": "toast-top-right",
                                    "preventDuplicates": false,
                                    "onclick": null,
                                    "showDuration": "300",
                                    "hideDuration": "1000",
                                    "timeOut": "5000",
                                    "extendedTimeOut": "1000",
                                    "showEasing": "swing",
                                    "hideEasing": "linear",
                                    "showMethod": "fadeIn",
                                    "hideMethod": "fadeOut"
                                }
                                Command: toastr["warning"]("Tổng tiền đơn hàng phải từ " + parseInt($("#editkhuyenmai option:selected").attr("data-hanmuc").replace(/[^\d.]/g, '')).format() + " trở lên.", "Thông báo")
                                prevent = 1;
                                return false;
                            }
                        }
                    }
                }
                if (prevent == 0) {
                    if ($("#editkhachhang").val() == "" || $("#tablehanghoaedit > tbody > tr").length == 0) {
                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": true,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        Command: toastr["warning"]("Xin điền đầy đủ thông tin đơn hàng", "Thông báo")
                    }
                    else if ($("#editkhuyenmai option:selected").attr("data-bbtt") == "1") {
                        $.ajax({
                            url: lang + '/crm/checkbbtt',
                            type: "POST",
                            datatype: 'json',
                            contentType: "application/json",
                            data: '{makh: ' + JSON.stringify($("#editkhachhang").attr('data-makh')) + ', mactkm:' + JSON.stringify($("#editkhuyenmai").val()) + '}',
                            success: function (data) {
                                if (data == 0) {
                                    $.confirm({
                                        title: '<b>CẢNH BÁO</b>',
                                        content: 'Không tìm thấy BBTT <b class="text-danger">' + $("#editkhuyenmai").val() + '</b> của khách hàng này trong danh mục BBTT. Vui lòng liên hệ bộ phận xuất hóa đơn để thêm vào danh mục BBTT !',
                                        buttons: {
                                            cancel: {
                                                text: 'Đóng',
                                                btnClass: 'btn-blue',
                                                keys: ['enter', 'shift'],
                                                action: function () {

                                                }
                                            }
                                        }
                                    });
                                }
                                else {
                                    $.ajax({
                                        url: lang + '/crm/GETCKBBTT',
                                        type: "POST",
                                        datatype: 'json',
                                        contentType: "application/json",
                                        data: '{makh: ' + JSON.stringify($("#editkhachhang").attr('data-makh')) + ', mactkm: ' + JSON.stringify($("#editkhuyenmai").val()) + '}',
                                        success: function (data) {
                                            $("#tilechietkhauedit").text(data);
                                            $.confirm({
                                                title: '<b>THÔNG BÁO</b>',
                                                content: 'Bạn có chắc chắn thay đổi thông tin đơn hàng này ? </br>Tỉ lệ chiết khấu là <b class="text-danger">' + $("#tilechietkhauedit").text() + '%</b>',
                                                buttons: {
                                                    confirm: {
                                                        text: 'Chắc chắn',
                                                        btnClass: 'btn-success',
                                                        keys: ['enter'],
                                                        action: function () {
                                                            $.post('@Url.Action("DelHoaDon", "Order")', { Id: $("#editdonhang").text() },
                                                           function (data) {
                                                               if(data != 1)
                                                               {
                                                                   var data1 = [];
                                                                   $("#tablehanghoaedit > tbody >tr").each(function () {
                                                                           data1.push({
                                                                               "NGAYGIAO": $("#editngaygiao").val()
                                                                              , "NGAY": data
                                                                              , "STT": $(this).find('td:eq(0)').text()
                                                                              , "MADH": $("#editdonhang").text()
                                                                              , "DONVI": $("#editkhachhang").attr('data-donvi')
                                                                              , "KHACHHANG": $("#editkhachhang").attr('data-makh')
                                                                              , "MACTKM": $("#editkhuyenmai").val()
                                                                              , "TENCTKM": $("#editkhuyenmai option:selected").attr('tabindex')
                                                                              , "MACTHT": $("#editcthotro").val()
                                                                              , "MAHH": $(this).find('.hanghoa').attr("data-mahh")
                                                                              , "MATDV": $("#editkhachhang").attr('data-matdv')
                                                                              , "TENHH": $(this).find('.hanghoa').attr("data-tenhh")
                                                                              , "DVT": $(this).find('.hanghoa').attr("data-dvt")
                                                                              , "SOLUONG": Number($(this).find(".sl3").val().toString().replace(/[^\d.]/g, '').replace(".00",""))
                                                                                      , "SOLUONG2": Number($(this).find('.sl2').val().toString().replace(/[^\d.]/g, '').replace(".00",""))
                                                               , "SOLUONG3": Number($(this).find('.sl1').val().toString().replace(/[^\d.]/g, '').replace(".00",""))
                                                                              , "GIABAN_VAT": Number($(this).find('.giaban_vat').val().replace(/[^\d.]/g, '').replace(".00",""))
                                                                              , "VAT": $("#editvat").val()
                                                                               , "GHICHU": $("#editghichu").val()
                                                                               , "ck": Number($(this).find('.ck').val().replace(/[^\d.]/g, '').replace(".00", ""))
                                                                           });

                                                                   });
                                                                   $.ajax({
                                                                       url: '@Url.Action("AddHoaDon", "Order")',
                                                                       //headers: { '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() },
                                                                       type: "POST",
                                                                       datatype: 'json',
                                                                       contentType: "application/json",
                                                                       data: JSON.stringify(data1),
                                                                       success: function (data) {
                                                                           $.confirm({
                                                                               title: '<b>THÔNG BÁO</b>',
                                                                               content: 'Đã chỉnh sửa thành công đơn hàng số <b>' + data + '</b>.',
                                                                               buttons: {
                                                                                   confirm: {
                                                                                       text: 'Đóng',
                                                                                       btnClass: 'btn-primary',
                                                                                       keys: ['enter'],
                                                                                       action: function () {
                                                                                           window.location.reload();
                                                                                       }
                                                                                   }

                                                                               }
                                                                           });
                                                                       }
                                                                   });
                                                               }
                                                               else
                                                               {
                                                                   $.confirm({
                                                                       title: '<b>THÔNG BÁO</b>',
                                                                       content: 'Đơn hàng này đã được duyệt hoặc bị từ chối, không thể chỉnh sửa!',
                                                                       buttons: {
                                                                           confirm: {
                                                                               text: 'Đóng',
                                                                               btnClass: 'btn-primary',
                                                                               keys: ['enter'],
                                                                               action: function () {
                                                                                   setTimeout(function () {
                                                                                       window.location.reload();
                                                                                   }, 300);
                                                                               }
                                                                           }
                                                                       }
                                                                   });
                                                               }
                                                           });
                                                        }
                                                    },
                                                    cancel: {
                                                        text: 'Hủy',
                                                        btnClass: 'btn-danger',
                                                        keys: ['esc'],
                                                        action: function () {

                                                        }
                                                    }
                                                }
                                            });
                                        },
                                        error: function (request, status, error) {
                                            toastr.options = {
                                                "closeButton": false,
                                                "debug": false,
                                                "newestOnTop": true,
                                                "progressBar": true,
                                                "positionClass": "toast-top-right",
                                                "preventDuplicates": false,
                                                "onclick": null,
                                                "showDuration": "300",
                                                "hideDuration": "1000",
                                                "timeOut": "5000",
                                                "extendedTimeOut": "1000",
                                                "showEasing": "swing",
                                                "hideEasing": "linear",
                                                "showMethod": "fadeIn",
                                                "hideMethod": "fadeOut"
                                            }
                                            Command: toastr["warning"]("Không kết nối được dữ liệu tỉ lệ chiết khấu", "Thông báo")
                                        },
                                        timeout: 5000,
                                    });

                                }
                            },
                            error: function (request, status, error) {
                                $.toast({
                                    heading: 'Không thành công',
                                    text: 'Vui lòng kiểm tra internet và thử lại !',
                                    position: 'top-right',
                                    loaderBg: '#ff6849',
                                    icon: 'error',
                                    hideAfter: 3500,
                                    stack: 6
                                });
                            },
                            timeout: 5000,
                        });

                    }
                    else {
                        $.confirm({
                            title: '<b>THÔNG BÁO</b>',
                            content: 'Bạn có chắc chắn thay đổi thông tin đơn hàng này ? </br>Tỉ lệ chiết khấu là <b class="text-danger">' + $("#tilechietkhauedit").text() + '%</b>',
                            buttons: {
                                confirm: {
                                    text: 'Chắc chắn',
                                    btnClass: 'btn-success',
                                    keys: ['enter'],
                                    action: function () {

                                        $.post('@Url.Action("DelHoaDon", "Order")', { Id: $("#editdonhang").text() },
                                       function (data) {
                                           if(data != 1)
                                           {
                                               var data1 = [];
                                               $("#tablehanghoaedit > tbody >tr").each(function () {
                                                       data1.push({
                                                           "NGAYGIAO": $("#editngaygiao").val()
                                                         , "NGAY": data
                                                         , "STT": $(this).find('td:eq(0)').text()
                                                         , "MADH": $("#editdonhang").text()
                                                         , "DONVI": $("#editkhachhang").attr('data-donvi')
                                                         , "KHACHHANG": $("#editkhachhang").attr('data-makh')
                                                         , "MACTKM": $("#editkhuyenmai").val()
                                                         , "TENCTKM": $("#editkhuyenmai option:selected").attr('tabindex')
                                                         , "MACTHT": $("#editcthotro").val()
                                                         , "MAHH": $(this).find('.hanghoa').attr("data-mahh")
                                                         , "MATDV": $("#editkhachhang").attr('data-matdv')
                                                         , "TENHH": $(this).find('.hanghoa').attr("data-tenhh")
                                                         , "DVT": $(this).find('.hanghoa').attr("data-dvt")
                                                         , "SOLUONG": Number($(this).find(".sl3").val().toString().replace(/[^\d.]/g, '').replace(".00",""))
                                                          , "SOLUONG2": Number($(this).find('.sl2').val().toString().replace(/[^\d.]/g, '').replace(".00",""))
                                                       , "SOLUONG3": Number($(this).find('.sl1').val().toString().replace(/[^\d.]/g, '').replace(".00",""))
                                                         , "GIABAN_VAT": Number($(this).find('.giaban_vat').val().replace(/[^\d.]/g, '').replace(".00",""))
                                                         , "VAT": $("#editvat").val()
                                                         , "GHICHU": $("#editghichu").val()
                                                           , "ck": Number($(this).find('.ck').val().replace(/[^\d.]/g, '').replace(".00", ""))
                                                       });
                                                   
                                               });
                                               $.ajax({
                                                   url: '@Url.Action("AddHoaDon", "Order")',
                                                   //headers: { '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() },
                                                   type: "POST",
                                                   datatype: 'json',
                                                   contentType: "application/json",
                                                   data: JSON.stringify(data1),
                                                   success: function (data) {
                                                       $.confirm({
                                                           title: '<b>THÔNG BÁO</b>',
                                                           content: 'Đã chỉnh sửa thành công đơn hàng số <b>' + data + '</b>.',
                                                           buttons: {
                                                               confirm: {
                                                                   text: 'Đóng',
                                                                   btnClass: 'btn-primary',
                                                                   keys: ['enter'],
                                                                   action: function () {
                                                                       window.location.reload();
                                                                   }
                                                               }
                                                           }
                                                       });
                                                   }
                                               });
                                           }
                                           else
                                           {
                                               $.confirm({
                                                   title: '<b>THÔNG BÁO</b>',
                                                   content: 'Đơn hàng này đã được duyệt hoặc bị từ chối, không thể chỉnh sửa!',
                                                   buttons: {
                                                       confirm: {
                                                           text: 'Đóng',
                                                           btnClass: 'btn-primary',
                                                           keys: ['enter'],
                                                           action: function () {
                                                               setTimeout(function () {
                                                                   window.location.reload();
                                                               }, 300);
                                                           }
                                                       }
                                                   }
                                               });
                                           }
                                       });
                                    }
                                },
                                cancel: {
                                    text: 'Hủy',
                                    btnClass: 'btn-danger',
                                    keys: ['esc'],
                                    action: function () {

                                    }
                                }
                            }
                        });
                    }
                }
            });
            //MÁY TÍNH
            //MOBILE
            $("#btnluumobile").click(function () {
                var prevent = 0;
                if (typeof $("#khuyenmai option:selected").attr("data-mahh") != "undefined") {
                    if($("#khuyenmai option:selected").attr("data-mahh") != "")
                    {
                        var mahhctkm = $("#khuyenmai option:selected").attr("data-mahh").split(",");
                        var khongthuoc = []
                        $('#tablehanghoa > tbody > tr').each(function () {
                            if (!mahhctkm.includes($(this).closest('tr').find('.hanghoa').attr("data-mahh"))) {
                                khongthuoc.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                            }
                        });
                        if (khongthuoc.length != 0) {
                            $.confirm({
                                title: '<b>CẢNH BÁO</b>',
                                content: 'Sản phẩm <b class="text-danger">' + khongthuoc.toString() + '</b> không nằm trong danh mục sản phẩm của CTKM <b class="text-danger">' + $("#khuyenmai").val() + '',
                                buttons: {
                                    cancel: {
                                        text: 'Đóng',
                                        btnClass: 'btn-blue',
                                        keys: ['enter', 'shift'],
                                        action: function () {

                                        }
                                    }
                                }
                            });
                            prevent = 1;
                            return false;
                        }
                    }
                }
                if (typeof $("#cthotro option:selected").attr("data-mahh") != "undefined") {
                    if($("#cthotro option:selected").attr("data-mahh") != "")
                    {
                        var mahhctht = $("#cthotro option:selected").attr("data-mahh").split(",");
                        var khongthuocht = []
                        $('#tablehanghoa > tbody > tr').each(function () {
                            if (!mahhctht.includes($(this).closest('tr').find('.hanghoa').attr("data-mahh"))) {
                                khongthuocht.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                            }
                        });
                        if (khongthuocht.length != 0) {
                            $.confirm({
                                title: '<b>CẢNH BÁO</b>',
                                content: 'Sản phẩm <b class="text-danger">' + khongthuocht.toString() + '</b> không nằm trong danh mục sản phẩm của CT hỗ trợ <b class="text-danger">' + $("#cthotro").val() + '',
                                buttons: {
                                    cancel: {
                                        text: 'Đóng',
                                        btnClass: 'btn-blue',
                                        keys: ['enter', 'shift'],
                                        action: function () {

                                        }
                                    }
                                }
                            });
                            prevent = 1;
                            return false;
                        }
                    }
                }
         if (typeof $("#cthotro option:selected").attr("data-mactkm") != "undefined") {
            if ($("#cthotro option:selected").attr("data-mactkm") != "") {
                var mactkmctht = $("#cthotro option:selected").attr("data-mactkm").split(",");
                if (!mactkmctht.includes($("#khuyenmai").val())) {
                    $.confirm({
                        title: '<b>CẢNH BÁO</b>',
                        content: 'Chương trình hỗ trợ <b class="text-danger">' + $("#cthotro").val() + '</b> không hỗ trợ cho CTKM <b class="text-danger">' + $("#khuyenmai").val() + '</b>. Vui lòng kiểm tra lại',
                        buttons: {
                            cancel: {
                                text: 'Đóng',
                                btnClass: 'btn-blue',
                                keys: ['enter', 'shift'],
                                action: function () {

                                }
                            }
                        }
                    });
                    prevent = 1;
                    return false;
                }
            }
        }
                var listhh = [];
                $('#tablehanghoa > tbody > tr').each(function () {
                    if ($(this).find('.sl3').val() == 0 || $(this).find('.sl3').val() == "") {
                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": true,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        Command: toastr["warning"]("Xin điền đẩy đủ số lượng cho sản phẩm " + $(this).closest('tr').find('.hanghoa').text() + " hoặc xóa sản phẩm", "Thông báo")
                        prevent = 1;
                        return false;
                    }
                    //else if (listhh.indexOf($(this).closest('tr').find('.hanghoa').attr("data-mahh")) != -1) {
                    //    toastr.options = {
                    //        "closeButton": false,
                    //        "debug": false,
                    //        "newestOnTop": true,
                    //        "progressBar": true,
                    //        "positionClass": "toast-top-right",
                    //        "preventDuplicates": false,
                    //        "onclick": null,
                    //        "showDuration": "300",
                    //        "hideDuration": "1000",
                    //        "timeOut": "5000",
                    //        "extendedTimeOut": "1000",
                    //        "showEasing": "swing",
                    //        "hideEasing": "linear",
                    //        "showMethod": "fadeIn",
                    //        "hideMethod": "fadeOut"
                    //    }
                    //    Command: toastr["warning"]("Sản phẩm " + $(this).closest('tr').find('.hanghoa').text() + " bị trùng với sản phẩm trước đó vui lòng xóa 1 trong 2 sản phẩm", "Thông báo")
                    //    prevent = 1;
                    //    return false;
                    //}
                    if ($("option:selected", this).first().val() != "") {
                        listhh.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                    }
                });
                if (typeof $("#khuyenmai option:selected").attr("data-tichdiem") != "undefined") {

                    if (parseInt($("#tongdiemtichluyeditmobile").text()) < parseInt($("#khuyenmai option:selected").attr("data-tichdiem"))) {
                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": true,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        Command: toastr["warning"]("Tổng điểm tích lũy không đủ " + $("#khuyenmai option:selected").attr("data-tichdiem") + " điểm để tạo đơn hàng vui lòng kiểm tra lại.", "Thông báo")
                        prevent = 1;
                        return false;
                    }
                }
                var tpcn = []
                var ksdb = []
                var hh40 = []
                var hh99 = []
                $('#tablehanghoa > tbody > tr').each(function () {
                    if ($(this).closest('tr').find('.hanghoa').attr("data-kiemsoat") == 1) {
                        ksdb.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                    }
                    else if ($(this).closest('tr').find('.hanghoa').attr("data-kiemsoat") == 2) {
                        tpcn.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                    }
                    else if ($(this).closest('tr').find('.hanghoa').attr("data-kiemsoat") == 40) {
                        hh40.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                    }
                    else if ($(this).closest('tr').find('.hanghoa').attr("data-kiemsoat") == 99) {
                        hh99.push($(this).closest('tr').find('.hanghoa').attr("data-mahh"));
                    }
                });
                if ((tpcn.length != 0 && $('#tablehanghoa > tbody > tr').length > tpcn.length) || (ksdb.length != 0 && $('#tablehanghoa > tbody > tr').length > ksdb.length)) {
                    toastr.options = {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": true,
                        "progressBar": true,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }
                    Command: toastr["warning"]("Bạn vui lòng tách đơn hàng có sản phẩm <b>Kiểm soát đặc biệt - Thực phẩm chức năng hoặc Nhóm hàng 40,99</b> ra đơn hàng riêng", "Thông báo")
                    prevent = 1;
                    return false;
                }
                if (tpcn.length == 0 && ksdb.length == 0) {
                    if (typeof $("#khuyenmai option:selected").attr("data-hanmuc") != "undefined") {
                        if ($("#khuyenmai option:selected").attr("data-hanmuc") != "") {
                            if (parseInt($("#thanhtien").text().replace(/[^\d.]/g, '')) < parseInt($("#khuyenmai option:selected").attr("data-hanmuc"))) {
                                toastr.options = {
                                    "closeButton": false,
                                    "debug": false,
                                    "newestOnTop": true,
                                    "progressBar": true,
                                    "positionClass": "toast-top-right",
                                    "preventDuplicates": false,
                                    "onclick": null,
                                    "showDuration": "300",
                                    "hideDuration": "1000",
                                    "timeOut": "5000",
                                    "extendedTimeOut": "1000",
                                    "showEasing": "swing",
                                    "hideEasing": "linear",
                                    "showMethod": "fadeIn",
                                    "hideMethod": "fadeOut"
                                }
                                Command: toastr["warning"]("Tổng tiền đơn hàng phải từ " + parseInt($("#khuyenmai option:selected").attr("data-hanmuc").replace(/[^\d.]/g, '')).format() + " trở lên.", "Thông báo")
                                prevent = 1;
                                return false;
                            }
                        }
                    }
                }
                if (prevent == 0) {
                    if ($("#khachhang").val() == "" || $("#tablehanghoa > tbody > tr").length == 0) {
                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": true,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        Command: toastr["warning"]("Xin điền đầy đủ thông tin đơn hàng", "Thông báo")
                    }
                    else if ($("#khuyenmai option:selected").attr("data-bbtt") == "1") {
                        $.ajax({
                            url: lang + '/crm/checkbbtt',
                            type: "POST",
                            datatype: 'json',
                            contentType: "application/json",
                            data: '{makh: ' + JSON.stringify($("#khachhang").attr('data-makh')) + ', mactkm:' + JSON.stringify($("#khuyenmai").val()) + '}',
                            success: function (data) {
                                if (data == 0) {
                                    $.confirm({
                                        title: '<b>CẢNH BÁO</b>',
                                        content: 'Không tìm thấy BBTT <b class="text-danger">' + $("#khuyenmai").val() + '</b> của khách hàng này trong danh mục BBTT. Vui lòng liên hệ bộ phận xuất hóa đơn để thêm vào danh mục BBTT !',
                                        buttons: {
                                            cancel: {
                                                text: 'Đóng',
                                                btnClass: 'btn-blue',
                                                keys: ['enter', 'shift'],
                                                action: function () {

                                                }
                                            }
                                        }
                                    });

                                }
                                else {
                                    $.ajax({
                                        url: lang + '/crm/GETCKBBTT',
                                        type: "POST",
                                        datatype: 'json',
                                        contentType: "application/json",
                                        data: '{makh: ' + JSON.stringify($("#khachhang").attr('data-makh')) + ', mactkm: ' + JSON.stringify($("#khuyenmai").val()) + '}',
                                        success: function (data) {
                                            $("#tilechietkhau").text(data);
                                            $.confirm({
                                                title: '<b>THÔNG BÁO</b>',
                                                content: 'Bạn có chắc chắn muốn thay đổi đơn hàng này ? </br>Tỉ lệ chiết khấu là <b class="text-danger">' + $("#tilechietkhau").text() + '%</b>',
                                                buttons: {
                                                    confirm: {
                                                        text: 'Chắc chắn',
                                                        btnClass: 'btn-success',
                                                        keys: ['enter'],
                                                        action: function () {
                                                            $.post('@Url.Action("DelHoaDon", "Order")', { Id: $("#editdonhangmobile").text() },
                                                           function (data) {
                                                               if(data != 1)
                                                               {
                                                                   var data1 = [];
                                                                   var dem = 1;
                                                                   $("#tablehanghoa > tbody >tr").each(function () {
                                                                           data1.push({
                                                                               "NGAYGIAO": $("#ngaygiao").val()
                                                                               , "NGAY": data
                                                                               , "STT": dem
                                                                               , "MADH": $("#editdonhangmobile").text()
                                                                               , "DONVI": $("#khachhang").attr('data-donvi')
                                                                               , "KHACHHANG": $("#khachhang").attr('data-makh')
                                                                               , "MACTKM": $("#khuyenmai").val()
                                                                               , "TENCTKM": $("#khuyenmai option:selected").attr('tabindex')
                                                                               , "MACTHT": $("#cthotro").val()
                                                                               , "MAHH": $(this).find(".hanghoa").attr("data-mahh")
                                                                               , "MATDV": $("#khachhang").attr('data-matdv')
                                                                               , "TENHH": $(this).find(".hanghoa").attr("data-tenhh")
                                                                               , "DVT": $(this).find(".hanghoa").attr("data-dvt")
                                                                               , "SOLUONG": Number($(this).find('.sl3').val().toString().replace(/[^\d.]/g, ''))
                                                                               , "SOLUONG2": Number($(this).find('.sl2').val().toString().replace(/[^\d.]/g, ''))
                                                                  , "SOLUONG3": Number($(this).find('.sl1').val().toString().replace(/[^\d.]/g, ''))
                                                                               , "GIABAN_VAT": Number($(this).find('.giaban_vat').val().replace(/[^\d.]/g, ''))
                                                                               , "VAT": $("#vat").val()
                                                                               , "GHICHU": $("#ghichu").val()
                                                                               , "ck": Number($(this).find('.ck').val().replace(/[^\d.]/g, '').replace(".00", ""))
                                                                           });
                                                                       
                                                                       dem = dem + 1;
                                                                   });

                                                                   $.ajax({
                                                                       url: '@Url.Action("AddHoaDon", "Order")',
                                                                       //headers: { '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() },
                                                                       type: "POST",
                                                                       datatype: 'json',
                                                                       contentType: "application/json",
                                                                       data: JSON.stringify(data1),
                                                                       success: function (data) {
                                                                           $.confirm({
                                                                               title: '<b>THÔNG BÁO</b>',
                                                                               content: 'Đã chỉnh sửa thành công đơn hàng số <b>' + data + '</b>.',
                                                                               buttons: {
                                                                                   confirm: {
                                                                                       text: 'Đóng',
                                                                                       btnClass: 'btn-primary',
                                                                                       keys: ['enter'],
                                                                                       action: function () {
                                                                                           window.location.reload();
                                                                                       }
                                                                                   }

                                                                               }
                                                                           });
                                                                       }
                                                                   });
                                                               }
                                                               else
                                                               {
                                                                   $.confirm({
                                                                       title: '<b>THÔNG BÁO</b>',
                                                                       content: 'Đơn hàng này đã được duyệt hoặc bị từ chối, không thể thay đổi!',
                                                                       buttons: {
                                                                           confirm: {
                                                                               text: 'Đóng',
                                                                               btnClass: 'btn-primary',
                                                                               keys: ['enter'],
                                                                               action: function () {
                                                                                   setTimeout(function () {
                                                                                       window.location.reload();
                                                                                   }, 300);
                                                                               }
                                                                           }
                                                                       }
                                                                   });
                                                               }

                                                           });
                                                        }
                                                    },
                                                    cancel: {
                                                        text: 'Hủy',
                                                        btnClass: 'btn-danger',
                                                        keys: ['esc'],
                                                        action: function () {

                                                        }
                                                    }
                                                }
                                            });
                                        },
                                        error: function (request, status, error) {
                                            toastr.options = {
                                                "closeButton": false,
                                                "debug": false,
                                                "newestOnTop": true,
                                                "progressBar": true,
                                                "positionClass": "toast-top-right",
                                                "preventDuplicates": false,
                                                "onclick": null,
                                                "showDuration": "300",
                                                "hideDuration": "1000",
                                                "timeOut": "5000",
                                                "extendedTimeOut": "1000",
                                                "showEasing": "swing",
                                                "hideEasing": "linear",
                                                "showMethod": "fadeIn",
                                                "hideMethod": "fadeOut"
                                            }
                                            Command: toastr["warning"]("Không thành công. Vui lòng kiểm tra lại kết nối Internet !", "Thông báo")
                                        },
                                        timeout: 5000,
                                    });

                                }
                            },
                            error: function (request, status, error) {
                                $.toast({
                                    heading: 'Không thành công',
                                    text: 'Vui lòng kiểm tra internet và thử lại !',
                                    position: 'top-right',
                                    loaderBg: '#ff6849',
                                    icon: 'error',
                                    hideAfter: 3500,
                                    stack: 6
                                });
                            },
                            timeout: 5000,
                        });
                    }
                    else {
                        $.confirm({
                            title: '<b>THÔNG BÁO</b>',
                            content: 'Bạn có chắc chắn muốn thay đổi đơn hàng này ? </br>Tỉ lệ chiết khấu là <b class="text-danger">' + $("#tilechietkhau").text() + '%</b>',
                            buttons: {
                                confirm: {
                                    text: 'Chắc chắn',
                                    btnClass: 'btn-success',
                                    keys: ['enter'],
                                    action: function () {
                                        $.post('@Url.Action("DelHoaDon", "Order")', { Id: $("#editdonhangmobile").text() },
                                       function (data) {
                                           if(data != 1)
                                           {
                                               var data1 = [];
                                               var dem = 1;
                                               $("#tablehanghoa > tbody >tr").each(function () {
                                                       data1.push({
                                                           "NGAYGIAO": $("#ngaygiao").val()
                                                          , "NGAY": data
                                                          , "STT": dem
                                                          , "MADH": $("#editdonhangmobile").text()
                                                          , "DONVI": $("#khachhang").attr('data-donvi')
                                                          , "KHACHHANG": $("#khachhang").attr('data-makh')
                                                          , "MACTKM": $("#khuyenmai").val()
                                                          , "TENCTKM": $("#khuyenmai option:selected").attr('tabindex')
                                                          , "MACTHT": $("#cthotro").val()
                                                          , "MAHH": $(this).find(".hanghoa").attr("data-mahh")
                                                          , "MATDV": $("#khachhang").attr('data-matdv')
                                                          , "TENHH": $(this).find(".hanghoa").attr("data-tenhh")
                                                          , "DVT": $(this).find(".hanghoa").attr("data-dvt")
                                                          , "SOLUONG": Number($(this).find('.sl3').val().toString().replace(/[^\d.]/g, ''))
                                                          , "SOLUONG2": Number($(this).find('.sl2').val().toString().replace(/[^\d.]/g, ''))
                                                          , "SOLUONG3": Number($(this).find('.sl1').val().toString().replace(/[^\d.]/g, ''))
                                                          , "GIABAN_VAT": Number($(this).find('.giaban_vat').val().replace(/[^\d.]/g, ''))
                                                          , "VAT": $("#vat").val()
                                                           , "GHICHU": $("#ghichu").val()
                                                           , "ck": Number($(this).find('.ck').val().replace(/[^\d.]/g, '').replace(".00", ""))
                                                       });
                                                   
                                                   dem = dem + 1;
                                               });

                                               $.ajax({
                                                   url: '@Url.Action("AddHoaDon", "Order")',
                                                   //headers: { '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() },
                                                   type: "POST",
                                                   datatype: 'json',
                                                   contentType: "application/json",
                                                   data: JSON.stringify(data1),
                                                   success: function (data) {
                                                       $.confirm({
                                                           title: '<b>THÔNG BÁO</b>',
                                                           content: 'Đã chỉnh sửa thành công đơn hàng số <b>' + data + '</b>.',
                                                           buttons: {
                                                               confirm: {
                                                                   text: 'Đóng',
                                                                   btnClass: 'btn-primary',
                                                                   keys: ['enter'],
                                                                   action: function () {
                                                                       window.location.reload();
                                                                   }
                                                               }
                                                           }
                                                       });
                                                   }
                                               });
                                           }
                                           else
                                           {
                                               $.confirm({
                                                   title: '<b>THÔNG BÁO</b>',
                                                   content: 'Đơn hàng này đã được duyệt hoặc bị từ chối, không thể thay đổi!',
                                                   buttons: {
                                                       confirm: {
                                                           text: 'Đóng',
                                                           btnClass: 'btn-primary',
                                                           keys: ['enter'],
                                                           action: function () {
                                                               setTimeout(function () {
                                                                   window.location.reload();
                                                               }, 300);
                                                           }
                                                       }
                                                   }
                                               });
                                           }

                                       });
                                    }
                                },
                                cancel: {
                                    text: 'Hủy',
                                    btnClass: 'btn-danger',
                                    keys: ['esc'],
                                    action: function () {

                                    }
                                }
                            }
                        });


                    }
                }
            });
            $("#khuyenmai").change(function () {
                if (typeof $("#khuyenmai option:selected").attr("data-ck") != "undefined" && $("#khuyenmai option:selected").attr("data-ck") != "") {
                    $("#tilechietkhau").text($("#khuyenmai option:selected").attr("data-ck"));
                }
                else {
                    $.ajax({
                        url: lang + '/crm/GETCKBBTT',
                        type: "POST",
                        datatype: 'json',
                        contentType: "application/json",
                        data: '{makh: ' + JSON.stringify($("#khachhang").attr('data-makh')) + ', mactkm: ' + JSON.stringify($("#khuyenmai").val()) + '}',
                        success: function (data) {
                            $("#tilechietkhau").text(data);
                        },
                        error: function (request, status, error) {
                            toastr.options = {
                                "closeButton": false,
                                "debug": false,
                                "newestOnTop": true,
                                "progressBar": true,
                                "positionClass": "toast-top-right",
                                "preventDuplicates": false,
                                "onclick": null,
                                "showDuration": "300",
                                "hideDuration": "1000",
                                "timeOut": "5000",
                                "extendedTimeOut": "1000",
                                "showEasing": "swing",
                                "hideEasing": "linear",
                                "showMethod": "fadeIn",
                                "hideMethod": "fadeOut"
                            }
                            Command: toastr["warning"]("Không kết nối được dữ liệu tỉ lệ chiết khấu", "Thông báo")
                        },
                        timeout: 5000,
                    });
                }
            });
            $("#editkhuyenmai").change(function () {
                if (typeof $("#editkhuyenmai option:selected").attr("data-ck") != "undefined" && $("#editkhuyenmai option:selected").attr("data-ck") != "") {
                    $("#tilechietkhauedit").text($("#editkhuyenmai option:selected").attr("data-ck"));
                }
                else {
                    $.ajax({
                        url: lang + '/crm/GETCKBBTT',
                        type: "POST",
                        datatype: 'json',
                        contentType: "application/json",
                        data: '{makh: ' + JSON.stringify($("#editkhachhang").attr('data-makh')) + ', mactkm: ' + JSON.stringify($("#editkhuyenmai").val()) + '}',
                        success: function (data) {

                            $("#tilechietkhauedit").text(data);
                        },
                        error: function (request, status, error) {
                            toastr.options = {
                                "closeButton": false,
                                "debug": false,
                                "newestOnTop": true,
                                "progressBar": true,
                                "positionClass": "toast-top-right",
                                "preventDuplicates": false,
                                "onclick": null,
                                "showDuration": "300",
                                "hideDuration": "1000",
                                "timeOut": "5000",
                                "extendedTimeOut": "1000",
                                "showEasing": "swing",
                                "hideEasing": "linear",
                                "showMethod": "fadeIn",
                                "hideMethod": "fadeOut"
                            }
                            Command: toastr["warning"]("Không kết nối được dữ liệu tỉ lệ chiết khấu", "Thông báo")
                        },
                        timeout: 5000,
                    });
                }
            });
            //MOBILE
        });
    </script>
}
